<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NavTag</title>
  <style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; background: #0f172a; color: #e5e7eb; }
    .wrap { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; }
    .card { width: 100%; max-width: 360px; background: #1e293b; border: 1px solid #334155; border-radius: 24px; padding: 32px 24px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); text-align: center; }
    .logo { width: 80px; height: 80px; border-radius: 20px; margin-bottom: 20px; object-fit: cover; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
    .title { font-size: 24px; font-weight: 700; margin: 0 0 8px; color: #f8fafc; letter-spacing: -0.025em; }
    .desc { font-size: 14px; color: #94a3b8; margin: 0 0 32px; line-height: 1.5; font-weight: 500; }
    .actions { display: flex; flex-direction: column; gap: 12px; width: 100%; }
    .btn { display: flex; align-items: center; justify-content: center; width: 100%; padding: 14px 20px; border-radius: 12px; background: #3b82f6; color: #fff; font-weight: 600; font-size: 15px; text-decoration: none; box-sizing: border-box; transition: background-color 0.2s; border: none; cursor: pointer; }
    .btn:active { transform: scale(0.98); }
    .btn.alt { background: #334155; color: #f1f5f9; }
    .tip { margin-top: 24px; font-size: 13px; color: #64748b; line-height: 1.5; padding: 0 12px; }
  </style>
  <meta name="referrer" content="no-referrer">
</head>
<body>
  <div class="wrap">
    <div class="card">
      <img src="./resource/logo.png" alt="NavTag Logo" class="logo" onerror="this.style.display='none'">
      <h1 class="title">NavTag</h1>
      <p class="desc">More than finding, unveil the journey.</p>
      <div id="actions" class="actions" style="display:none"></div>
      <p id="tip" class="tip" style="display:none"></p>
    </div>
  </div>
  <script>
    fetch('app-config.json').then(function (r) { return r.json() }).then(function (cfg) {
      const iosId = String(cfg.ios_id || '').trim()
      const pkg = String(cfg.pkg || '').trim()
      const apk = String(cfg.apk || '').trim()
      const ua = navigator.userAgent
      const isIOS = /iPhone|iPad|iPod/i.test(ua) || (/(Macintosh|Mac OS X)/i.test(ua) && navigator.maxTouchPoints > 0)
      const isAndroid = /Android/i.test(ua)
      const isInApp = /(MicroMessenger|MQQBrowser|QQ|Weibo|AlipayClient|AliApp|DingTalk|FBAN|FBAV|Instagram|Line|XHS|Feishu|Lark|wxwork|WeCom|Douyin|Aweme|Kuaishou|Kwai)/i.test(ua)
      const isWeChat = /MicroMessenger/i.test(ua)
      const isChrome = /Chrome\/\d+/.test(ua) && !/Edg\/|OPR\//.test(ua)
      const isCNVendor = /(HuaweiBrowser|HUAWEI|HMSCore|HMOS|HarmonyOS|EMUI|Mi\s?Browser|MiuiBrowser|MIUI|XiaoMi|Redmi|POCO|VivoBrowser|FuntouchOS|OriginOS|OPPO|OppoBrowser|ColorOS|Realme|OnePlus|H2OS|MeizuBrowser|Flyme|MEIZU|ZTE|Nubia|Lenovo|ZUK|Coolpad|Hisense|360Browser|QHBrowser|BaiduBrowser|SogouMobileBrowser|Sogou|LBBROWSER|Liebao|XBrowser|UCBrowser|Quark|HONOR|CM\s?Browser)/i.test(ua)
      const isMac = /(Macintosh|Mac OS X)/i.test(ua) && navigator.maxTouchPoints === 0
      const appStore = iosId ? `https://apps.apple.com/app/${iosId}` : ''
      const playStoreWeb = pkg ? `https://play.google.com/store/apps/details?id=${pkg}` : ''
      const playIntent = (pkg && apk) ? `intent://details?id=${pkg}#Intent;scheme=market;package=com.android.vending;S.browser_fallback_url=${encodeURIComponent(apk)};end` : ''
      function showFallback() {
        const actions = document.getElementById('actions')
        const tip = document.getElementById('tip')
        actions.innerHTML = ''
        if (appStore) {
          const a = document.createElement('a')
          a.className = 'btn'
          a.textContent = '前往 App Store'
          a.href = appStore
          actions.appendChild(a)
        }
        if (playStoreWeb) {
          const a = document.createElement('a')
          a.className = 'btn'
          a.textContent = '前往 Google 商店'
          a.href = playStoreWeb
          actions.appendChild(a)
        }
        /* if (pkg) {
          const a = document.createElement('a')
          a.className = 'btn alt'
          a.textContent = '打开 内置商店 App'
          a.href = `market://details?id=${pkg}`
          actions.appendChild(a)
        } */
        if (apk) {
          const a = document.createElement('a')
          a.className = 'btn'
          a.textContent = '直接下载 APK'
          a.href = apk
          actions.appendChild(a)
        }
        if (isInApp) {
          tip.style.display = 'block'
          tip.textContent = isWeChat ? '当前为微信内置浏览器，请点击右上角在系统浏览器打开或使用下方按钮。' : '当前为内置浏览器，可能无法直接跳转，请在系统浏览器打开或使用上方按钮。'
          const copyBtn = document.createElement('button')
          copyBtn.className = 'btn alt'
          copyBtn.textContent = '复制当前链接'
          copyBtn.onclick = function () { if (navigator.clipboard) navigator.clipboard.writeText(location.href) }
          actions.appendChild(copyBtn)
        }
        actions.style.display = actions.childElementCount ? 'flex' : 'none'
      }
      showFallback()
      if (isMac) {
        return
      }
      if (isIOS && appStore) {
        location.replace(appStore)
        return
      }
      if (isAndroid) {
        if (isInApp) return
        if (isCNVendor && apk) {
          location.replace(apk)
          return
        }
        if (isChrome && playIntent) {
          location.replace(playIntent)
          return
        }
        if (playStoreWeb) {
          location.replace(playStoreWeb)
          return
        }
      }
    }).catch(function () {
      document.getElementById('actions').style.display = 'none'
    })
  </script>
</body>
</html>
