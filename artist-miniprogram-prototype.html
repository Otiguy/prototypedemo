<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è‰ºäººç«¯å°ç¨‹åºåŸå‹ - DMG</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
    .phone-container {
      width: 390px;
      height: 844px;
      border: 1px solid #ddd;
      overflow: hidden;
      position: relative;
      background: #fff;
    }
    .status-bar { height: 44px; }
    .main-content { height: 664px; overflow-y: auto; }
    .tab-bar { height: 92px; border-top: 1px solid #e5e5e5; }
    .hidden { display: none !important; }
    .album-group.collapsed .album-songs { display: none; }
    .album-group.collapsed .collapse-icon { transform: rotate(-90deg); }
    .collapse-icon { transition: transform 0.3s; }
    .badge {
      position: absolute;
      top: -2px;
      right: -2px;
      background: #ff3b30;
      color: white;
      border-radius: 50%;
      font-size: 10px;
      font-weight: 500;
      width: 17px;
      height: 17px;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 16px;
      padding: 0;
      box-sizing: border-box;
    }
    .tag {
      display: inline-flex;
      align-items: center;
      background: #f0f0f0;
      padding: 4px 8px;
      border-radius: 4px;
      margin: 2px;
      font-size: 14px;
    }
    .tag-remove {
      margin-left: 4px;
      cursor: pointer;
      color: #999;
    }
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.active { display: flex; }
    .modal-content {
      background: white;
      border-radius: 12px;
      width: 350px;
      max-height: 600px;
      overflow-y: auto;
      padding: 20px;
    }
    .chart-container { width: 100%; height: 280px; }
    .chart-container-tall { width: 100%; height: 560px; }
    .fab-button {
      position: absolute;
      bottom: 110px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #F93B3D;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(249, 59, 61, 0.4);
      cursor: pointer;
      z-index: 999;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .fab-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(249, 59, 61, 0.5);
    }
    .fab-button:active {
      transform: scale(0.95);
    }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e5e5e5;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 8px;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #F93B3D, #FF6B6D);
      transition: width 0.3s;
      border-radius: 4px;
    }
    .filter-chips {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    .chip {
      padding: 6px 12px;
      border-radius: 16px;
      border: 1px solid #d1d5db;
      background: white;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    .chip.active {
      background: #F93B3D;
      color: white;
      border-color: #F93B3D;
    }
    .chip:hover:not(.active) {
      background: #f3f4f6;
    }
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 12px;
    }
    .breadcrumb-item {
      cursor: pointer;
    }
    .breadcrumb-item:hover {
      color: #F93B3D;
    }
    .breadcrumb-separator {
      color: #d1d5db;
    }
    /* å¾®ä¿¡å°ç¨‹åºå¯¼èˆªæ æ ·å¼ */
    .mp-statusbar {
      height: 44px;
      background: #fff;
    }
    .mp-navbar {
      height: 44px;
      background: #fff;
      border-bottom: 1px solid #e5e5e5;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .mp-navbar-left {
      width: 80px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .mp-navbar-center {
      flex: 1;
      text-align: center;
      font-weight: 500;
      font-size: 16px;
    }
    .mp-navbar-right {
      width: 80px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 4px;
    }
    .mp-btn-back, .mp-btn-home {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .mp-capsule {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border: 1px solid #d1d5db;
      border-radius: 16px;
    }
    /* æ‰‹é£ç´æŠ˜å é¢æ¿æ ·å¼ */
    .accordion-panel {
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      margin-bottom: 8px;
      overflow: hidden;
    }
    .accordion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: #f9fafb;
      cursor: pointer;
      user-select: none;
    }
    .accordion-header:hover {
      background: #f3f4f6;
    }
    .accordion-title {
      font-weight: 500;
      font-size: 14px;
    }
    .accordion-icon {
      transition: transform 0.3s;
      font-size: 12px;
      color: #6b7280;
    }
    .accordion-panel.collapsed .accordion-icon {
      transform: rotate(-90deg);
    }
    .accordion-content {
      padding: 12px;
      background: white;
    }
    .accordion-panel.collapsed .accordion-content {
      display: none;
    }
    .accordion-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    /* è¿”å›é¡¶éƒ¨æŒ‰é’® */
    .back-to-top {
      position: absolute;
      bottom: 120px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(249, 59, 61, 0.9);
      color: white;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transition: all 0.3s;
    }
    .back-to-top:hover {
      background: rgba(249, 59, 61, 1);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(249, 59, 61, 0.4);
    }
    .back-to-top.show {
      display: flex;
    }
    /* ç­›é€‰æ ‡ç­¾æ ·å¼ */
    .filter-tag {
      padding: 6px 12px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      background: white;
      font-size: 13px;
      color: #374151;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }
    .filter-tag.active {
      background: #FEE2E2;
      border-color: #F93B3D;
      color: #F93B3D;
      font-weight: 500;
    }
    .filter-tag:hover:not(.active) {
      background: #F9FAFB;
      border-color: #9CA3AF;
    }

    /* å›¾è¡¨ Tooltip ä¸‹é’»é“¾æ¥æ ·å¼ */
    .tooltip-drilldown-link {
      color: #F93B3D;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid #eee;
      font-size: 12px;
      cursor: pointer;
      user-select: none;
    }
    .tooltip-drilldown-link:hover {
      color: #d32f2f;
      text-decoration: underline;
    }

    /* æ»šåŠ¨é€‰æ‹©å™¨æ ·å¼ */
    .picker-container {
      position: relative;
      overflow: hidden;
    }

    .picker-column {
      height: 100%;
      overflow-y: scroll;
      scroll-snap-type: y mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .picker-column::-webkit-scrollbar {
      display: none;
    }

    .picker-scroller {
      padding: 96px 0;
    }

    .picker-item {
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: #999;
      scroll-snap-align: center;
      transition: all 0.2s;
    }

    .picker-item.selected {
      font-weight: 600;
      color: #333;
      font-size: 18px;
      transform: scale(1.1);
    }

    .picker-mask {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      background: linear-gradient(
        to bottom,
        rgba(255, 255, 255, 0.95) 0%,
        rgba(255, 255, 255, 0) 25%,
        rgba(255, 255, 255, 0) 75%,
        rgba(255, 255, 255, 0.95) 100%
      );
      z-index: 1;
    }

    .picker-indicator {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 40px;
      transform: translateY(-50%);
      border-top: 1px solid #e5e5e5;
      border-bottom: 1px solid #e5e5e5;
      pointer-events: none;
      z-index: 0;
    }

    /* æ—¶é—´æ¨¡å¼æ ‡ç­¾é€‰ä¸­æ•ˆæœ */
    #start-time-tab,
    #end-time-tab {
      position: relative;
      padding-bottom: 6px;
      transition: all 0.2s;
    }

    #start-time-tab.active,
    #end-time-tab.active {
      color: #F93B3D;
    }

    #start-time-tab.active::after,
    #end-time-tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: #F93B3D;
      border-radius: 1.5px;
    }
  </style>
</head>
<body class="bg-gray-100">
  <div class="phone-container mx-auto my-8" data-page="app-container">

    <!-- çŠ¶æ€æ å ä½ -->
    <div class="mp-statusbar" data-role="statusbar"></div>

    <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
    <div class="mp-navbar" data-role="navbar" id="mpNavbar">
      <div class="mp-navbar-left" id="navbarLeft">
        <!-- è¿”å›æŒ‰é’®ä¼šæ ¹æ®é¡µé¢åŠ¨æ€æ˜¾ç¤º -->
      </div>
      <div class="mp-navbar-center" id="navbarTitle">ä½œå“ç®¡ç†</div>
      <div class="mp-navbar-right">
        <div class="mp-capsule">
          <span style="font-size: 16px;">Â·Â·Â·</span>
          <span style="font-size: 16px;">â­•</span>
        </div>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content bg-gray-50" id="mainContent" data-component="main-content">

      <!-- ä½œå“ç®¡ç†é¡µé¢ -->
      <div id="page-works" class="page-container" data-page="works">

        <!-- ä½œå“åˆ—è¡¨è§†å›¾ -->
        <div id="works-list-view" class="h-full flex flex-col">
          <!-- æœç´¢å’Œç­›é€‰ -->
          <div class="bg-white p-4 border-b" data-component="search-filter">
            <div class="flex gap-2 mb-3">
              <input type="text" placeholder="æœç´¢æ­Œæ›²åç§°..." class="flex-1 px-3 py-2 border rounded-lg text-sm" id="searchInput">
              <button class="px-4 py-2 bg-red-500 text-white rounded-lg text-sm" data-type="button">æœç´¢</button>
            </div>
            <div class="flex gap-2">
              <select class="flex-1 px-3 py-2 border rounded-lg text-sm" id="albumFilter">
                <option value="">å…¨éƒ¨ä¸“è¾‘</option>
                <option value="ä¸“è¾‘A">ä¸“è¾‘A</option>
                <option value="ä¸“è¾‘B">ä¸“è¾‘B</option>
              </select>
              <select class="flex-1 px-3 py-2 border rounded-lg text-sm" id="statusFilter">
                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                <option value="å®¡æ ¸ä¸­">å®¡æ ¸ä¸­</option>
                <option value="å¾…ä¸Šçº¿">å¾…ä¸Šçº¿</option>
                <option value="å·²ä¸Šçº¿">å·²ä¸Šçº¿</option>
              </select>
            </div>
          </div>

          <!-- æ­Œæ›²åˆ—è¡¨ -->
          <div class="flex-1 overflow-y-auto p-4" id="songListContainer" data-component="song-list">

            <!-- ä¸“è¾‘ç»„ - ä¸“è¾‘A -->
            <div class="album-group mb-4" data-album="ä¸“è¾‘A">
              <div class="flex items-center justify-between bg-gray-100 p-3 rounded-t-lg cursor-pointer" onclick="toggleAlbumGroup(this)">
                <div class="flex items-center gap-2">
                  <svg class="w-4 h-4 collapse-icon" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
                  <span class="font-medium">ä¸“è¾‘A</span>
                  <span class="text-xs text-gray-500">(3é¦–)</span>
                </div>
              </div>
              <div class="album-songs bg-white rounded-b-lg overflow-hidden">
                <!-- æ­Œæ›²1 -->
                <div class="song-item flex items-center gap-3 p-3 border-b hover:bg-gray-50" data-type="card" data-status="å®¡æ ¸ä¸­">
                  <div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center text-xs text-gray-500">å°é¢</div>
                  <div class="flex-1">
                    <div class="font-medium">æ˜¥å¤©çš„æ•…äº‹</div>
                    <div class="text-xs text-gray-500">ä¸“è¾‘A Â· 2024-01-15</div>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs px-2 py-1 bg-yellow-100 text-yellow-700 rounded">å®¡æ ¸ä¸­</span>
                    <button class="flex items-center justify-center w-8 h-8 rounded-full hover:bg-gray-100 active:bg-gray-200" onclick="editSong(1)" title="ç¼–è¾‘">
                      <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <!-- æ­Œæ›²2 -->
                <div class="song-item flex items-center gap-3 p-3 border-b hover:bg-gray-50" data-type="card" data-status="å¾…ä¸Šçº¿">
                  <div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center text-xs text-gray-500">å°é¢</div>
                  <div class="flex-1">
                    <div class="font-medium">å¤æ—¥å›å¿†</div>
                    <div class="text-xs text-gray-500">ä¸“è¾‘A Â· 2024-02-20</div>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs px-2 py-1 bg-red-50 text-red-700 rounded">å¾…ä¸Šçº¿</span>
                    <div class="w-8 h-8"></div>
                  </div>
                </div>
                <!-- æ­Œæ›²3 -->
                <div class="song-item flex items-center gap-3 p-3 hover:bg-gray-50" data-type="card" data-status="å·²ä¸Šçº¿">
                  <div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center text-xs text-gray-500">å°é¢</div>
                  <div class="flex-1">
                    <div class="font-medium">ç§‹å¤©çš„ç«¥è¯</div>
                    <div class="text-xs text-gray-500">ä¸“è¾‘A Â· 2024-03-10</div>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded">å·²ä¸Šçº¿</span>
                    <div class="w-8 h-8"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ä¸“è¾‘ç»„ - ä¸“è¾‘B -->
            <div class="album-group mb-4" data-album="ä¸“è¾‘B">
              <div class="flex items-center justify-between bg-gray-100 p-3 rounded-t-lg cursor-pointer" onclick="toggleAlbumGroup(this)">
                <div class="flex items-center gap-2">
                  <svg class="w-4 h-4 collapse-icon" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
                  <span class="font-medium">ä¸“è¾‘B</span>
                  <span class="text-xs text-gray-500">(2é¦–)</span>
                </div>
              </div>
              <div class="album-songs bg-white rounded-b-lg overflow-hidden">
                <div class="song-item flex items-center gap-3 p-3 border-b hover:bg-gray-50" data-type="card" data-status="å·²ä¸Šçº¿">
                  <div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center text-xs text-gray-500">å°é¢</div>
                  <div class="flex-1">
                    <div class="font-medium">å†¬å­£æ‹æ­Œ</div>
                    <div class="text-xs text-gray-500">ä¸“è¾‘B Â· 2024-04-05</div>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded">å·²ä¸Šçº¿</span>
                    <div class="w-8 h-8"></div>
                  </div>
                </div>
                <div class="song-item flex items-center gap-3 p-3 hover:bg-gray-50" data-type="card" data-status="å®¡æ ¸ä¸­">
                  <div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center text-xs text-gray-500">å°é¢</div>
                  <div class="flex-1">
                    <div class="font-medium">é›¨åå½©è™¹</div>
                    <div class="text-xs text-gray-500">ä¸“è¾‘B Â· 2024-04-15</div>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs px-2 py-1 bg-yellow-100 text-yellow-700 rounded">å®¡æ ¸ä¸­</span>
                    <button class="flex items-center justify-center w-8 h-8 rounded-full hover:bg-gray-100 active:bg-gray-200" onclick="editSong(2)" title="ç¼–è¾‘">
                      <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- å•æ›²ç»„ -->
            <div class="album-group mb-4" data-album="å•æ›²">
              <div class="flex items-center justify-between bg-gray-100 p-3 rounded-t-lg cursor-pointer" onclick="toggleAlbumGroup(this)">
                <div class="flex items-center gap-2">
                  <svg class="w-4 h-4 collapse-icon" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
                  <span class="font-medium">å•æ›²</span>
                  <span class="text-xs text-gray-500">(1é¦–)</span>
                </div>
              </div>
              <div class="album-songs bg-white rounded-b-lg overflow-hidden">
                <div class="song-item flex items-center gap-3 p-3 hover:bg-gray-50" data-type="card" data-status="å·²ä¸Šçº¿">
                  <div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center text-xs text-gray-500">å°é¢</div>
                  <div class="flex-1">
                    <div class="font-medium">ç‹¬è¡Œ</div>
                    <div class="text-xs text-gray-500">å•æ›² Â· 2024-05-01</div>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded">å·²ä¸Šçº¿</span>
                    <div class="w-8 h-8"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ç©ºçŠ¶æ€é¡µ -->
            <div id="emptyState" class="hidden bg-white rounded-lg p-8 text-center mt-4">
              <div class="text-6xl mb-4">ğŸ”</div>
              <p class="text-gray-500 text-base mb-2">æœªæ‰¾åˆ°ç›¸å…³ä½œå“</p>
              <p class="text-xs text-gray-400">å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰æ¡ä»¶</p>
            </div>

          </div>

          <!-- æ‚¬æµ®åˆ›å»ºæŒ‰é’® -->
          <button class="fab-button" onclick="showCreateSong()" data-type="button" id="fabCreate">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
            </svg>
          </button>
        </div>

        <!-- åˆ›å»º/ç¼–è¾‘ä½œå“è§†å›¾ -->
        <div id="works-form-view" class="h-full hidden flex flex-col bg-white">
          <div class="flex-1 overflow-y-auto p-3">
            <form id="songForm">
              <div class="mb-3">
                <label class="block text-sm font-medium mb-2">æ­Œæ›²å *</label>
                <input type="text" id="songName" required class="w-full px-3 py-2 border rounded-lg" placeholder="è¯·è¾“å…¥æ­Œæ›²åç§°">
              </div>

              <div class="mb-3">
                <label class="block text-sm font-medium mb-2">ä¸“è¾‘å</label>
                <select id="albumName" class="w-full px-3 py-2 border rounded-lg" onchange="handleAlbumChange(this)">
                  <option value="">é€‰æ‹©ä¸“è¾‘æˆ–ç•™ç©ºä½œä¸ºå•æ›²</option>
                  <option value="ä¸“è¾‘A">ä¸“è¾‘A</option>
                  <option value="ä¸“è¾‘B">ä¸“è¾‘B</option>
                  <option value="æ–°å»º">+ æ–°å»ºä¸“è¾‘</option>
                </select>
                <div id="newAlbumInput" class="hidden mt-2">
                  <input type="text" id="newAlbumName" class="w-full px-3 py-2 border rounded-lg" placeholder="è¾“å…¥æ–°ä¸“è¾‘åç§°">
                </div>
              </div>

              <div class="mb-3">
                <label class="block text-sm font-medium mb-2">åˆä½œè‰ºäºº</label>
                <div class="border rounded-lg p-2" id="artistTagsContainer">
                  <input type="text" id="artistInput" class="w-full outline-none text-sm" placeholder="è¾“å…¥è‰ºäººåç§°,ç”¨é€—å·åˆ†éš”(æ”¯æŒä¸­è‹±æ–‡é€—å·)" value="">
                </div>
                <div id="artistPreview" class="mt-2 text-sm text-gray-600"></div>
              </div>

              <div class="mb-3">
                <label class="block text-sm font-medium mb-2">å¤‡æ³¨</label>
                <textarea id="songNotes" class="w-full px-3 py-2 border rounded-lg" rows="2" placeholder="æ·»åŠ å¤‡æ³¨ä¿¡æ¯..."></textarea>
              </div>

              <div class="mb-3">
                <label class="block text-sm font-medium mb-2">ä¸Šä¼ æ­Œæ›² *</label>
                <div class="border-2 border-dashed rounded-lg p-4 text-center">
                  <input type="file" id="songFile" accept=".mp3,.wav" class="hidden" onchange="handleFileUpload(event)">
                  <button type="button" onclick="document.getElementById('songFile').click()" class="p-3 bg-gray-100 rounded-lg inline-flex items-center justify-center hover:bg-gray-200 transition-colors" data-type="button" title="ä¸Šä¼ æ­Œæ›²">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="#333333">
                      <path d="M260-160q-91 0-155.5-63T40-377q0-78 47-139t123-78q25-92 100-149t170-57q117 0 198.5 81.5T760-520q69 8 114.5 59.5T920-340q0 75-52.5 127.5T740-160H520q-33 0-56.5-23.5T440-240v-206l-64 62-56-56 160-160 160 160-56 56-64-62v206h220q42 0 71-29t29-71q0-42-29-71t-71-29h-60v-80q0-83-58.5-141.5T480-720q-83 0-141.5 58.5T280-520h-20q-58 0-99 41t-41 99q0 58 41 99t99 41h100v80H260Zm220-280Z"/>
                    </svg>
                  </button>
                  <p class="text-xs text-gray-500">æ”¯æŒ MP3ã€WAV æ ¼å¼,æœ€å¤§100MB</p>
                  <div id="fileInfo" class="mt-2 text-sm text-gray-700"></div>
                  <div id="uploadProgress" class="hidden mt-3">
                    <div class="progress-bar">
                      <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 text-center">
                      <span id="progressText">ä¸Šä¼ ä¸­... 0%</span>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>

          <div class="p-3 bg-white border-t">
            <button onclick="submitSongForm()" class="w-full py-2.5 bg-red-500 text-white rounded-lg font-medium" data-type="button">æäº¤ä½œå“</button>
          </div>
        </div>

      </div>

      <!-- æ•°æ®ä¸­å¿ƒé¡µé¢ -->
      <div id="page-data" class="page-container hidden" data-page="data-center">
        <!-- äºŒçº§Tabå¯¼èˆª -->
        <div class="bg-white border-b sticky top-0 z-10" data-component="tab-nav">
          <div class="flex">
            <button class="flex-1 py-3 text-sm font-medium border-b-2 border-red-500 text-red-500" onclick="switchDataTab('works')" id="tab-works" data-type="tab">ä½œå“ç»è¥</button>
            <button class="flex-1 py-3 text-sm font-medium text-gray-500" onclick="switchDataTab('content')" id="tab-content" data-type="tab">å†…å®¹ç»è¥</button>
            <button class="flex-1 py-3 text-sm font-medium text-gray-500" onclick="switchDataTab('fans')" id="tab-fans" data-type="tab">ç²‰ä¸ç»è¥</button>
            <button class="flex-1 py-3 text-sm font-medium text-gray-500" onclick="switchDataTab('fire')" id="tab-fire" data-type="tab">ç«åŠ›æŒ‡æ•°</button>
          </div>
        </div>

        <!-- ä½œå“ç»è¥Tabå†…å®¹ -->
        <div id="data-works" class="data-tab-content overflow-y-auto">
          <!-- ä¸‰çº§åˆ†é¡µå¿«é€Ÿå¯¼èˆª -->
          <div class="bg-white p-3 border-b flex gap-2 overflow-x-auto" data-component="sub-nav">
            <button class="px-3 py-1 text-xs rounded-full bg-red-500 text-white whitespace-nowrap" onclick="scrollToSection('revenue')">ç»è¥æƒ…å†µ</button>
            <button class="px-3 py-1 text-xs rounded-full bg-gray-200 text-gray-700 whitespace-nowrap" onclick="scrollToSection('platform-dist')">å¹³å°åˆ†å¸ƒ</button>
          </div>

          <div class="p-4 space-y-6">
            <!-- ç»è¥æƒ…å†µ -->
            <div id="revenue" class="bg-white rounded-lg p-4 shadow-sm" data-component="revenue-chart">
              <!-- æ ‡é¢˜è¡Œ -->
              <h3 id="revenue-title" class="font-medium mb-3">ç»è¥æƒ…å†µ - CNY</h3>

              <!-- æ—¶é—´ç­›é€‰å’Œç­›é€‰æŒ‰é’® -->
              <div class="flex items-center gap-2 mb-3" id="revenue-time-filter">
                <span class="text-sm text-gray-600">æ—¶é—´:</span>
                <button onclick="showPeriodPicker('revenue')" class="flex items-center gap-1 px-3 py-1.5 text-xs border border-gray-300 rounded bg-white">
                  <span id="revenue-period-display">2024.01 - 2024.04</span>
                  <svg class="w-3 h-3 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>
                </button>
                <button id="filter-btn-revenue" onclick="showFilterPanel('revenue')" class="text-xs px-3 py-1.5 rounded border border-gray-300 text-gray-600">ç­›é€‰</button>
              </div>

              <!-- é¢åŒ…å±‘å¯¼èˆª (ä»…ç”¨äºå›¾è¡¨ç‚¹å‡»ä¸‹é’») -->
              <div class="breadcrumb" id="revenue-breadcrumb">
                <span class="breadcrumb-item" onclick="resetChartDrilldown('revenue')">å…¨éƒ¨æ•°æ®</span>
              </div>

              <div style="position: relative;">
                <div class="chart-container" id="chart-revenue"></div>
                <!-- å›¾è¡¨ Tooltip -->
                <div id="chart-tooltip-revenue" class="hidden absolute bg-white shadow-xl rounded-lg p-3 border border-gray-200" style="z-index: 100; max-width: 200px; pointer-events: auto;">
                  <div id="tooltip-content-revenue"></div>
                </div>
              </div>
            </div>

            <!-- å¹³å°åˆ†å¸ƒ -->
            <div id="platform-dist" class="bg-white rounded-lg p-4 shadow-sm" data-component="platform-chart">
              <!-- æ ‡é¢˜è¡Œ -->
              <h3 id="platform-dist-title" class="font-medium mb-3">å¹³å°åˆ†å¸ƒ - CNY</h3>

              <!-- æ—¶é—´é€‰æ‹©å™¨å’Œç­›é€‰æŒ‰é’® -->
              <div class="flex items-center gap-2 mb-4">
                <span class="text-sm text-gray-600">æ—¶é—´:</span>
                <button onclick="showPeriodPicker('platform-dist')" class="flex items-center gap-1 px-3 py-1.5 text-xs border border-gray-300 rounded bg-white">
                  <span id="platform-dist-period-display">2024.01 - 2024.04</span>
                  <svg class="w-3 h-3 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>
                </button>
                <button id="filter-btn-platform-dist" onclick="showFilterPanel('platform-dist')" class="text-xs px-3 py-1.5 rounded border border-gray-300 text-gray-600">ç­›é€‰</button>
              </div>
              <div class="chart-container-tall" id="chart-platform"></div>
            </div>
          </div>
        </div>

        <!-- å†…å®¹ç»è¥Tabå†…å®¹ -->
        <div id="data-content" class="data-tab-content hidden overflow-y-auto">
          <!-- æŒ‡æ ‡å¡ç‰‡ -->
          <div class="p-4 bg-gray-50">
            <h3 class="font-medium text-sm mb-3">é€‰æ‹©æŒ‡æ ‡</h3>
            <div class="grid grid-cols-4 gap-2">
              <!-- æ­Œæ›²æ•° -->
              <div class="bg-white rounded p-2 shadow-sm cursor-pointer" onclick="selectMetric('songs')" id="metric-songs">
                <div class="flex flex-col">
                  <div class="flex items-center justify-between mb-1">
                    <svg class="w-4 h-4 text-purple-500" fill="currentColor" viewBox="0 0 20 20"><path d="M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.37 4.37 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z"/></svg>
                    <input type="radio" name="content-metric" value="songs" checked>
                  </div>
                  <span class="text-xs text-gray-600 mb-1">æ­Œæ›²æ•°</span>
                  <div class="text-lg font-bold text-gray-900">12</div>
                  <div class="text-xs text-green-500">â†‘ 8.3%</div>
                </div>
              </div>

              <!-- ç‚¹æ’­æ•° -->
              <div class="bg-white rounded p-2 shadow-sm cursor-pointer" onclick="selectMetric('plays')" id="metric-plays">
                <div class="flex flex-col">
                  <div class="flex items-center justify-between mb-1">
                    <svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/></svg>
                    <input type="radio" name="content-metric" value="plays">
                  </div>
                  <span class="text-xs text-gray-600 mb-1">ç‚¹æ’­æ•°</span>
                  <div class="text-lg font-bold text-gray-900">1.2M</div>
                  <div class="text-xs text-green-500">â†‘ 23.7%</div>
                </div>
              </div>

              <!-- ç‚¹èµæ•° -->
              <div class="bg-white rounded p-2 shadow-sm cursor-pointer" onclick="selectMetric('likes')" id="metric-likes">
                <div class="flex flex-col">
                  <div class="flex items-center justify-between mb-1">
                    <svg class="w-4 h-4 text-pink-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"/></svg>
                    <input type="radio" name="content-metric" value="likes">
                  </div>
                  <span class="text-xs text-gray-600 mb-1">ç‚¹èµæ•°</span>
                  <div class="text-lg font-bold text-gray-900">35K</div>
                  <div class="text-xs text-green-500">â†‘ 15.2%</div>
                </div>
              </div>

              <!-- è¯„è®ºæ•° -->
              <div class="bg-white rounded p-2 shadow-sm cursor-pointer" onclick="selectMetric('comments')" id="metric-comments">
                <div class="flex flex-col">
                  <div class="flex items-center justify-between mb-1">
                    <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/></svg>
                    <input type="radio" name="content-metric" value="comments">
                  </div>
                  <span class="text-xs text-gray-600 mb-1">è¯„è®ºæ•°</span>
                  <div class="text-lg font-bold text-gray-900">8.5K</div>
                  <div class="text-xs text-green-500">â†‘ 12.8%</div>
                </div>
              </div>
            </div>
          </div>

          <div class="p-4 space-y-4">

            <!-- è¶‹åŠ¿å›¾è¡¨ -->
            <div class="bg-white rounded-lg p-4 shadow-sm">
              <h3 class="font-medium mb-3" id="selectedMetricTitle">æ­Œæ›²æ•°è¶‹åŠ¿</h3>

              <!-- æ—¶é—´ç­›é€‰å’Œç­›é€‰æŒ‰é’® -->
              <div class="flex items-center gap-2 mb-3" id="content-time-filter">
                <span class="text-sm text-gray-600">æ—¶é—´:</span>
                <button onclick="showPeriodPicker('content')" class="flex items-center gap-1 px-3 py-1.5 text-xs border border-gray-300 rounded bg-white">
                  <span id="content-period-display">2024.01 - 2024.04</span>
                  <svg class="w-3 h-3 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>
                </button>
                <button id="filter-btn-content" onclick="showFilterPanel('content')" class="text-xs px-3 py-1.5 rounded border border-gray-300 text-gray-600">ç­›é€‰</button>
              </div>

              <div class="chart-container" id="chart-content"></div>
            </div>
          </div>
        </div>

        <!-- ç²‰ä¸ç»è¥Tabå†…å®¹ -->
        <div id="data-fans" class="data-tab-content hidden p-4">
          <div class="bg-white rounded-lg p-6 text-center">
            <div class="text-4xl mb-2">ğŸš§</div>
            <p class="text-gray-500">åŠŸèƒ½å¼€å‘ä¸­,æ•¬è¯·æœŸå¾…</p>
          </div>
        </div>

        <!-- ç«åŠ›æŒ‡æ•°Tabå†…å®¹ -->
        <div id="data-fire" class="data-tab-content hidden p-4">
          <div class="bg-white rounded-lg p-6 text-center">
            <div class="text-4xl mb-2">ğŸš§</div>
            <p class="text-gray-500">åŠŸèƒ½å¼€å‘ä¸­,æ•¬è¯·æœŸå¾…</p>
          </div>
        </div>

        <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
        <div class="back-to-top" id="backToTop" onclick="scrollToTop()">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
          </svg>
        </div>

        <!-- æ—¶é—´æ®µé€‰æ‹©å¼¹çª— -->
        <div id="period-picker-modal" class="absolute inset-0 bg-black bg-opacity-50 hidden flex items-end" style="z-index: 100;" onclick="hidePeriodPicker()">
          <div class="bg-white rounded-t-2xl w-full" onclick="event.stopPropagation()">

            <!-- æ ‡é¢˜ -->
            <div class="text-center py-4 border-b">
              <h3 class="font-medium text-lg">é€‰æ‹©æœˆä»½</h3>
            </div>

            <!-- å½“å‰é€‰æ‹©æ˜¾ç¤º -->
            <div class="px-4 py-3 bg-gray-50 flex items-center justify-center gap-2 text-sm">
              <div class="flex items-center cursor-pointer" onclick="switchTimeMode('start')" id="start-time-tab">
                <span class="text-gray-500">å¼€å§‹æ—¶é—´</span>
                <span id="start-display" class="ml-2 text-gray-900 font-medium">2024.01</span>
              </div>
              <span class="text-gray-400 mx-1">-</span>
              <div class="flex items-center cursor-pointer" onclick="switchTimeMode('end')" id="end-time-tab">
                <span class="text-gray-500">ç»“æŸæ—¶é—´</span>
                <span id="end-display" class="ml-2 text-gray-900 font-medium">2024.04</span>
              </div>
            </div>

            <!-- åŒåˆ—æ»šåŠ¨é€‰æ‹©å™¨ -->
            <div class="picker-container flex h-64 relative">
              <!-- é®ç½©å±‚ -->
              <div class="picker-mask"></div>

              <!-- é€‰ä¸­æŒ‡ç¤ºæ¡ -->
              <div class="picker-indicator"></div>

              <!-- å·¦åˆ—:å¹´ä»½ -->
              <div class="picker-column flex-1">
                <div class="picker-scroller" id="year-scroller">
                  <div class="picker-item" data-value="2022">2022å¹´</div>
                  <div class="picker-item" data-value="2023">2023å¹´</div>
                  <div class="picker-item selected" data-value="2024">2024å¹´</div>
                  <div class="picker-item" data-value="2025">2025å¹´</div>
                  <div class="picker-item" data-value="2026">2026å¹´</div>
                  <div class="picker-item" data-value="2027">2027å¹´</div>
                  <div class="picker-item" data-value="2028">2028å¹´</div>
                </div>
              </div>

              <!-- å³åˆ—:æœˆä»½ -->
              <div class="picker-column flex-1">
                <div class="picker-scroller" id="month-scroller">
                  <div class="picker-item selected" data-value="01">1æœˆ</div>
                  <div class="picker-item" data-value="02">2æœˆ</div>
                  <div class="picker-item" data-value="03">3æœˆ</div>
                  <div class="picker-item" data-value="04">4æœˆ</div>
                  <div class="picker-item" data-value="05">5æœˆ</div>
                  <div class="picker-item" data-value="06">6æœˆ</div>
                  <div class="picker-item" data-value="07">7æœˆ</div>
                  <div class="picker-item" data-value="08">8æœˆ</div>
                  <div class="picker-item" data-value="09">9æœˆ</div>
                  <div class="picker-item" data-value="10">10æœˆ</div>
                  <div class="picker-item" data-value="11">11æœˆ</div>
                  <div class="picker-item" data-value="12">12æœˆ</div>
                </div>
              </div>
            </div>

            <!-- ç¡®å®šæŒ‰é’® -->
            <div class="p-4">
              <button class="w-full py-3 rounded-lg font-medium text-white" style="background-color: #ea580c;" onclick="confirmPeriod()">
                ç¡®å®š
              </button>
            </div>

          </div>
        </div>
      </div>

      <!-- ä¸ªäººä¸­å¿ƒé¡µé¢ -->
      <div id="page-profile" class="page-container hidden overflow-y-auto" data-page="profile">
        <!-- Profile -->
        <div class="bg-white p-4 border-b" data-component="profile-header">
          <div class="flex items-center gap-4" onclick="editProfile()" style="cursor: pointer;">
            <div class="w-16 h-16 bg-gray-300 rounded-full flex items-center justify-center text-2xl">ğŸ‘¤</div>
            <div class="flex-1">
              <div class="font-medium text-lg">è‰ºäººæ˜µç§°</div>
              <div class="text-sm text-gray-500">UID: 123456789</div>
            </div>
            <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
          </div>
        </div>

        <!-- èœå•åˆ—è¡¨ -->
        <div class="p-4 space-y-3">
          <!-- æ¶ˆæ¯ -->
          <div class="bg-white rounded-lg shadow-sm" data-component="menu-item">
            <button class="w-full p-4 flex items-center justify-between" onclick="showMessages()">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-red-50 rounded-lg flex items-center justify-center relative">
                  <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/></svg>
                  <span class="badge">3</span>
                </div>
                <div class="text-left">
                  <div class="font-medium">æ¶ˆæ¯</div>
                  <div class="text-xs text-gray-500">æŸ¥çœ‹ç³»ç»Ÿé€šçŸ¥</div>
                </div>
              </div>
              <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
            </button>
          </div>

          <!-- æˆ‘çš„ç­¾çº¦ -->
          <div class="bg-white rounded-lg shadow-sm" data-component="menu-item">
            <button class="w-full p-4 flex items-center justify-between" onclick="showContracts()">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z"/></svg>
                </div>
                <div class="text-left">
                  <div class="font-medium">æˆ‘çš„ç­¾çº¦</div>
                  <div class="text-xs text-gray-500">æŸ¥çœ‹ç”µå­åˆåŒ</div>
                </div>
              </div>
              <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
            </button>
          </div>

          <!-- æ”¶ç›Šæç° -->
          <div class="bg-white rounded-lg shadow-sm opacity-50" data-component="menu-item">
            <button class="w-full p-4 flex items-center justify-between" disabled>
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z"/></svg>
                </div>
                <div class="text-left">
                  <div class="font-medium">æ”¶ç›Šæç°</div>
                  <div class="text-xs text-gray-500">åŠŸèƒ½å¼€å‘ä¸­</div>
                </div>
              </div>
            </button>
          </div>
        </div>
      </div>

      <!-- æ¶ˆæ¯åˆ—è¡¨é¡µé¢ -->
      <div id="page-messages" class="page-container hidden h-full flex flex-col bg-white" data-page="messages">
        <div class="flex-1 overflow-y-auto" id="messageList">
          <!-- æ¶ˆæ¯1 -->
          <div class="message-item p-4 border-b hover:bg-gray-50 cursor-pointer" onclick="showMessageDetail(1)" data-read="false">
            <div class="flex items-start gap-3">
              <div class="w-2 h-2 bg-red-500 rounded-full mt-2 flex-shrink-0"></div>
              <div class="flex-1">
                <div class="font-medium mb-1">ä½œå“å®¡æ ¸é€šè¿‡</div>
                <div class="text-sm text-gray-600 mb-1">æ‚¨çš„æ­Œæ›²ã€Šæ˜¥å¤©çš„æ•…äº‹ã€‹å·²é€šè¿‡å®¡æ ¸,ç­‰å¾…ç»çºªäººä¸Šçº¿</div>
                <div class="text-xs text-gray-400">2024-04-15 14:30</div>
              </div>
            </div>
          </div>

          <!-- æ¶ˆæ¯2 -->
          <div class="message-item p-4 border-b hover:bg-gray-50 cursor-pointer" onclick="showMessageDetail(2)" data-read="false">
            <div class="flex items-start gap-3">
              <div class="w-2 h-2 bg-red-500 rounded-full mt-2 flex-shrink-0"></div>
              <div class="flex-1">
                <div class="font-medium mb-1">ç»è¥æ•°æ®æ›´æ–°</div>
                <div class="text-sm text-gray-600 mb-1">ç½‘æ˜“äº‘éŸ³ä¹å¹³å°å·²å¯¼å…¥æœ€æ–°ç»è¥æ•°æ®</div>
                <div class="text-xs text-gray-400">2024-04-14 09:15</div>
              </div>
            </div>
          </div>

          <!-- æ¶ˆæ¯3 -->
          <div class="message-item p-4 border-b hover:bg-gray-50 cursor-pointer" onclick="showMessageDetail(3)" data-read="false">
            <div class="flex items-start gap-3">
              <div class="w-2 h-2 bg-red-500 rounded-full mt-2 flex-shrink-0"></div>
              <div class="flex-1">
                <div class="font-medium mb-1">ä½œå“å·²ä¸Šçº¿</div>
                <div class="text-sm text-gray-600 mb-1">æ‚¨çš„æ­Œæ›²ã€Šå¤æ—¥å›å¿†ã€‹å·²åœ¨TMEå¹³å°æ­£å¼ä¸Šçº¿</div>
                <div class="text-xs text-gray-400">2024-04-13 16:45</div>
              </div>
            </div>
          </div>

          <!-- å·²è¯»æ¶ˆæ¯ -->
          <div class="message-item p-4 border-b hover:bg-gray-50 cursor-pointer opacity-60" onclick="showMessageDetail(4)" data-read="true">
            <div class="flex items-start gap-3">
              <div class="w-2 h-2 bg-transparent rounded-full mt-2 flex-shrink-0"></div>
              <div class="flex-1">
                <div class="font-medium mb-1">ç³»ç»Ÿç»´æŠ¤é€šçŸ¥</div>
                <div class="text-sm text-gray-600 mb-1">å¹³å°å°†äºä»Šæ™š22:00-24:00è¿›è¡Œç³»ç»Ÿç»´æŠ¤</div>
                <div class="text-xs text-gray-400">2024-04-12 10:00</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- æ¶ˆæ¯è¯¦æƒ…é¡µé¢ -->
      <div id="page-message-detail" class="page-container hidden h-full flex flex-col bg-white" data-page="message-detail">
        <div class="flex-1 overflow-y-auto p-4">
          <div id="messageDetailContent">
            <h2 class="text-xl font-medium mb-2">ä½œå“å®¡æ ¸é€šè¿‡</h2>
            <p class="text-sm text-gray-500 mb-4">2024-04-15 14:30</p>
            <div class="text-gray-700 leading-relaxed">
              <p>å°Šæ•¬çš„è‰ºäºº,</p>
              <br>
              <p>æ‚¨æäº¤çš„æ­Œæ›²ã€Šæ˜¥å¤©çš„æ•…äº‹ã€‹å·²é€šè¿‡å¹³å°å®¡æ ¸ã€‚</p>
              <br>
              <p>å½“å‰çŠ¶æ€: å¾…ä¸Šçº¿</p>
              <p>ä¸‹ä¸€æ­¥: ç­‰å¾…ç»çºªäººç¡®è®¤åå³å¯ä¸Šçº¿å‘å¸ƒ</p>
              <br>
              <p>æ„Ÿè°¢æ‚¨çš„æ”¯æŒ!</p>
            </div>
          </div>
        </div>
      </div>

      <!-- åˆåŒæŸ¥çœ‹é¡µé¢ -->
      <div id="page-contracts" class="page-container hidden h-full flex flex-col bg-white" data-page="contracts">
        <div class="flex-1 overflow-y-auto">
          <div class="p-4 bg-yellow-50 border-b">
            <p class="text-sm text-gray-700">ğŸ“„ è°ƒç”¨è…¾è®¯ç”µå­ç­¾æŸ¥çœ‹åˆåŒ(iframeæ¨¡å¼)</p>
          </div>
          <iframe src="about:blank" class="w-full" style="height: 600px; border: none;" title="è…¾è®¯ç”µå­ç­¾åˆåŒæŸ¥çœ‹"></iframe>
          <div class="p-4 text-center text-sm text-gray-500">
            å®é™…ä½¿ç”¨æ—¶æ­¤å¤„å°†åµŒå…¥è…¾è®¯ç”µå­ç­¾çš„webview
          </div>
        </div>
      </div>

      <!-- ä¸ªäººèµ„æ–™ç¼–è¾‘é¡µé¢ -->
      <div id="page-profile-edit" class="page-container hidden h-full flex flex-col bg-gray-50" data-page="profile-edit">
        <div class="flex-1 overflow-y-auto">
          <!-- å¤´åƒ -->
          <div class="bg-white p-4 border-b">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-700">å¤´åƒ</span>
              <div class="flex items-center gap-3">
                <div class="w-14 h-14 bg-gray-300 rounded-full flex items-center justify-center text-2xl">ğŸ‘¤</div>
                <button class="text-red-500 text-sm" onclick="uploadAvatar()">æ›´æ¢å¤´åƒ</button>
              </div>
            </div>
          </div>

          <!-- æ˜µç§° -->
          <div class="bg-white p-4 border-b mt-3">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-700">æ˜µç§°</span>
              <div class="flex items-center gap-2">
                <input type="text" value="è‰ºäººæ˜µç§°" class="text-sm text-right border-none outline-none" style="width: 150px;" id="nickname-input" onblur="saveField('nickname')">
                <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
              </div>
            </div>
          </div>

          <!-- æ€§åˆ« -->
          <div class="bg-white p-4 border-b" onclick="showGenderPicker()">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-700">æ€§åˆ«</span>
              <div class="flex items-center gap-2">
                <span class="text-sm text-gray-900" id="gender-display">ç”·</span>
                <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
              </div>
            </div>
          </div>

          <!-- ç”Ÿæ—¥ -->
          <div class="bg-white p-4 border-b">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-700">ç”Ÿæ—¥</span>
              <div class="flex items-center gap-2">
                <input type="date" value="1990-01-01" class="text-sm text-right border-none outline-none text-gray-900" id="birthday-input" onchange="saveField('birthday')">
                <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
              </div>
            </div>
          </div>

          <!-- ç»‘å®šæ‰‹æœº -->
          <div class="bg-white p-4 border-b mt-3" onclick="showPhoneBinding()">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-700">ç»‘å®šæ‰‹æœº</span>
              <div class="flex items-center gap-2">
                <span class="text-sm text-gray-900" id="phone-display">138****5678</span>
                <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
              </div>
            </div>
          </div>

          <!-- UIDï¼ˆåªè¯»ï¼Œå¯å¤åˆ¶ï¼‰ -->
          <div class="bg-white p-4 border-b" onclick="copyUID()" style="cursor: pointer;">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-700">UID</span>
              <div class="flex items-center gap-2">
                <span class="text-sm text-gray-500" id="uid-text">123456789</span>
                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
              </div>
            </div>
          </div>

          <!-- ä¸ªäººä¿¡æ¯æ”¶é›† -->
          <div class="bg-white p-4 border-b mt-3" onclick="showPrivacyInfo('collect')">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-700">ä¸ªäººä¿¡æ¯æ”¶é›†</span>
              <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
            </div>
          </div>

          <!-- æƒé™æ¸…å• -->
          <div class="bg-white p-4 border-b" onclick="showPrivacyInfo('permission')">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-700">æƒé™æ¸…å•</span>
              <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/></svg>
            </div>
          </div>

          <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
          <div class="p-4">
            <button class="w-full py-3 bg-white text-red-500 rounded-lg font-medium border border-red-200" onclick="confirmLogout()">é€€å‡ºç™»å½•</button>
          </div>

          <!-- ç”¨æˆ·åè®®å’Œéšç§æ”¿ç­– -->
          <div class="px-4 pb-3 flex items-center justify-center gap-3 text-xs text-gray-500">
            <a href="javascript:void(0)" onclick="showAgreement('user')" class="text-red-500 underline">ç”¨æˆ·åè®®</a>
            <span>|</span>
            <a href="javascript:void(0)" onclick="showAgreement('privacy')" class="text-red-500 underline">éšç§æ”¿ç­–</a>
          </div>

          <!-- æ³¨é”€è´¦å·ï¼ˆæš‚æ—¶éšè—ï¼‰ -->
          <div class="px-4 pb-6 flex justify-center hidden">
            <a href="javascript:void(0)" onclick="showAccountDeletion()" class="text-xs text-gray-400 underline">æ³¨é”€è´¦å·</a>
          </div>
        </div>

        <!-- æ‰‹æœºç»‘å®šå¼¹çª—ï¼ˆç§»åˆ°å®¹å™¨å†…ï¼‰ -->
        <div id="phone-binding-modal" class="absolute inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center" style="z-index: 100;" onclick="hidePhoneBinding()">
          <div class="bg-white rounded-lg w-11/12 max-w-sm p-6" onclick="event.stopPropagation()">
            <h3 class="text-lg font-medium mb-4">ç»‘å®šæ‰‹æœºå·</h3>

            <div class="space-y-4">
              <div>
                <label class="text-sm text-gray-600">æ‰‹æœºå·</label>
                <input type="tel" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" class="w-full mt-1 px-3 py-2 border rounded-lg" id="new-phone-input" maxlength="11">
              </div>

              <div class="flex gap-2">
                <input type="text" placeholder="è¯·è¾“å…¥éªŒè¯ç " class="flex-1 px-3 py-2 border rounded-lg" id="verify-code-input" maxlength="6">
                <button class="px-4 py-2 bg-red-500 text-white rounded-lg text-sm whitespace-nowrap" onclick="sendVerifyCode()" id="send-code-btn">å‘é€éªŒè¯ç </button>
              </div>
            </div>

            <div class="flex gap-3 mt-6">
              <button class="flex-1 py-2 border border-gray-300 rounded-lg" onclick="hidePhoneBinding()">å–æ¶ˆ</button>
              <button class="flex-1 py-2 bg-red-500 text-white rounded-lg" onclick="confirmPhoneBinding()">ç¡®è®¤</button>
            </div>
          </div>
        </div>

        <!-- æ€§åˆ«é€‰æ‹©å¼¹çª—ï¼ˆç§»åˆ°å®¹å™¨å†…ï¼‰ -->
        <div id="gender-picker-modal" class="absolute inset-0 bg-black bg-opacity-50 hidden flex items-end" style="z-index: 100;" onclick="hideGenderPicker()">
          <div class="bg-white rounded-t-lg w-full" onclick="event.stopPropagation()">
            <div class="p-4 border-b flex items-center justify-between">
              <button class="text-gray-500" onclick="hideGenderPicker()">å–æ¶ˆ</button>
              <span class="font-medium">é€‰æ‹©æ€§åˆ«</span>
              <button class="text-red-500" onclick="confirmGender()">ç¡®å®š</button>
            </div>
            <div class="divide-y">
              <button class="w-full p-4 text-left hover:bg-gray-50" onclick="selectGender('ç”·')">
                <span id="gender-option-male">ç”·</span>
                <span class="float-right text-red-500 hidden" id="check-male">âœ“</span>
              </button>
              <button class="w-full p-4 text-left hover:bg-gray-50" onclick="selectGender('å¥³')">
                <span id="gender-option-female">å¥³</span>
                <span class="float-right text-red-500 hidden" id="check-female">âœ“</span>
              </button>
              <button class="w-full p-4 text-left hover:bg-gray-50" onclick="selectGender('å…¶ä»–')">
                <span id="gender-option-other">å…¶ä»–</span>
                <span class="float-right text-red-500 hidden" id="check-other">âœ“</span>
              </button>
            </div>
          </div>
        </div>

        <!-- ä¿å­˜æˆåŠŸæç¤ºï¼ˆæ·¡å‡ºåŠ¨ç”»ï¼‰ -->
        <div id="save-success-tip" class="absolute top-20 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-lg text-sm opacity-0 transition-opacity duration-300" style="z-index: 50; pointer-events: none;">
          ä¿å­˜æˆåŠŸ
        </div>
      </div>

      <!-- è´¦å·æ³¨é”€é¡»çŸ¥é¡µé¢ -->
      <div id="page-account-deletion" class="page-container hidden h-full flex flex-col bg-gray-50" data-page="account-deletion">
        <div class="flex-1 overflow-y-auto">
          <!-- æ³¨é”€å£°æ˜ -->
          <div class="bg-white p-4 mt-3">
            <h3 class="font-medium text-base mb-3">æ³¨é”€å£°æ˜</h3>
            <div class="text-sm text-gray-700 space-y-2">
              <p>åœ¨æ‚¨ç”³è¯·æ³¨é”€è´¦å·å‰ï¼Œè¯·ä»”ç»†é˜…è¯»ä»¥ä¸‹å†…å®¹ï¼š</p>
              <ul class="list-disc list-inside space-y-1 text-xs text-gray-600">
                <li>æ³¨é”€åï¼Œæ‚¨å°†<span class="text-red-500 font-medium">æ— æ³•å†ç™»å½•</span>æœ¬è´¦å·</li>
                <li>æ³¨é”€åï¼Œæ‚¨çš„<span class="text-red-500 font-medium">ä¸ªäººèµ„æ–™ã€ä½œå“ä¿¡æ¯å°†è¢«æ°¸ä¹…åˆ é™¤</span>ä¸”æ— æ³•æ¢å¤</li>
                <li>æ³¨é”€åï¼Œæ‚¨å°†<span class="text-red-500 font-medium">å¤±å»æ‰€æœ‰æ”¶ç›Šæƒç›Š</span>ï¼Œæœªæç°çš„æ”¶ç›Šå°†æ— æ³•é¢†å–</li>
                <li>æ³¨é”€åï¼Œæ‚¨ä¸å¹³å°ç­¾è®¢çš„<span class="text-red-500 font-medium">æ‰€æœ‰åˆåŒå°†è‡ªåŠ¨è§£é™¤</span></li>
                <li>æ³¨é”€åï¼Œæ‚¨åœ¨å¹³å°çš„<span class="text-red-500 font-medium">æ‰€æœ‰æ•°æ®ï¼ˆç²‰ä¸ã€æ’­æ”¾é‡ã€è¯„è®ºç­‰ï¼‰å°†è¢«æ¸…ç©º</span></li>
                <li>æ³¨é”€åï¼Œæ‚¨çš„æ‰‹æœºå·å°†åœ¨<span class="text-red-500 font-medium">30å¤©å</span>å¯é‡æ–°æ³¨å†Œ</li>
              </ul>
              <p class="mt-3 text-xs text-gray-500">è¯·ç¡®ä¿æ‚¨å·²äº†è§£æ³¨é”€åæœï¼Œè°¨æ…æ“ä½œã€‚</p>
            </div>
          </div>

          <!-- æ‰‹æœºå·éªŒè¯ -->
          <div class="bg-white p-4 mt-3">
            <h3 class="font-medium text-base mb-3">èº«ä»½éªŒè¯</h3>
            <div class="text-sm text-gray-600 mb-3">ä¸ºä¿æŠ¤æ‚¨çš„è´¦å·å®‰å…¨ï¼Œè¯·éªŒè¯ç»‘å®šçš„æ‰‹æœºå·</div>

            <div class="space-y-3">
              <div>
                <label class="text-sm text-gray-700">æ‰‹æœºå·</label>
                <input type="tel" value="138****5678" class="w-full mt-1 px-3 py-2 border rounded-lg bg-gray-100" disabled>
              </div>

              <div class="flex gap-2">
                <input type="text" placeholder="è¯·è¾“å…¥éªŒè¯ç " class="flex-1 px-3 py-2 border rounded-lg" id="deletion-verify-code" maxlength="6">
                <button class="px-4 py-2 bg-red-500 text-white rounded-lg text-sm whitespace-nowrap" onclick="sendDeletionCode()" id="deletion-send-btn">å‘é€éªŒè¯ç </button>
              </div>
            </div>
          </div>

          <!-- æ³¨é”€æœåŠ¡é¡»çŸ¥ -->
          <div class="bg-white p-4 mt-3">
            <div class="flex items-start gap-2">
              <input type="checkbox" id="deletion-agree-checkbox" class="mt-1" onchange="checkDeletionEnable()">
              <label for="deletion-agree-checkbox" class="text-xs text-gray-700 flex-1">
                æˆ‘å·²é˜…è¯»å¹¶åŒæ„<a href="javascript:void(0)" onclick="showDeletionTerms()" class="text-red-500 underline">ã€Šæ³¨é”€æœåŠ¡é¡»çŸ¥ã€‹</a>
              </label>
            </div>
          </div>

          <!-- åŒæ„æ³¨é”€æŒ‰é’® -->
          <div class="p-4">
            <button class="w-full py-3 bg-gray-300 text-gray-500 rounded-lg font-medium" id="confirm-deletion-btn" onclick="confirmAccountDeletion()" disabled>åŒæ„æ³¨é”€</button>
          </div>

          <!-- æ¸©é¦¨æç¤º -->
          <div class="px-4 pb-6">
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
              <div class="flex items-start gap-2">
                <span class="text-yellow-600">âš ï¸</span>
                <div class="text-xs text-gray-700">
                  <div class="font-medium mb-1">æ¸©é¦¨æç¤º</div>
                  <p>è´¦å·æ³¨é”€æ˜¯<span class="text-red-500">ä¸å¯é€†æ“ä½œ</span>ï¼Œè¯·å†æ¬¡ç¡®è®¤æ‚¨çš„å†³å®šã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»å®¢æœååŠ©å¤„ç†ã€‚</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Toastæç¤º -->
      <div id="toast" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-80 text-white px-6 py-3 rounded-lg hidden" style="z-index: 10000;">
        <span id="toast-message"></span>
      </div>

      <!-- Revenue ç­›é€‰æµ®å±‚ -->
      <div id="filter-panel-revenue" class="absolute inset-0 bg-black bg-opacity-50 hidden" style="z-index: 200;" onclick="hideFilterPanel('revenue')">
        <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl overflow-hidden" onclick="event.stopPropagation()">
          <!-- é¡¶éƒ¨æ‹–åŠ¨æ¡ -->
          <div class="flex justify-center py-2 bg-gray-50">
            <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
          </div>

          <!-- æ ‡é¢˜å’Œé‡ç½® -->
          <div class="flex items-center justify-between px-4 py-3 border-b">
            <span class="font-medium">ç­›é€‰æ¡ä»¶</span>
            <button onclick="resetFilters('revenue')" class="text-sm text-red-500">é‡ç½®</button>
          </div>

          <!-- å¯æ»šåŠ¨å†…å®¹åŒºåŸŸ -->
          <div class="max-h-[60vh] overflow-y-auto">

            <!-- å¸ç§åˆ†ç»„ -->
            <div class="border-b">
              <div class="flex items-center justify-between px-4 py-3 bg-gray-50">
                <span class="text-sm font-medium text-gray-700">å¸ç§</span>
              </div>
              <div id="currency-options-revenue" class="px-4 py-3">
                <div class="flex flex-wrap gap-2">
                  <button class="filter-tag active" data-value="cny" onclick="selectFilter('revenue', 'currency', 'cny', this)">CNY</button>
                  <button class="filter-tag" data-value="eur" onclick="selectFilter('revenue', 'currency', 'eur', this)">EUR</button>
                </div>
              </div>
            </div>

            <!-- å¹³å°åˆ†ç»„ -->
            <div class="border-b">
              <div class="flex items-center justify-between px-4 py-3 bg-gray-50">
                <span class="text-sm font-medium text-gray-700">å¹³å°</span>
                <button id="platform-expand-btn-revenue" onclick="toggleExpand('revenue', 'platform')" class="text-xs text-blue-500 hidden">å±•å¼€</button>
              </div>
              <div id="platform-options-revenue" class="px-4 py-3" data-expanded="true">
                <div class="flex flex-wrap gap-2">
                  <button class="filter-tag active" data-value="all" onclick="selectFilter('revenue', 'platform', 'all', this)">å…¨éƒ¨</button>
                  <button class="filter-tag" data-value="netease" onclick="selectFilter('revenue', 'platform', 'netease', this)">ç½‘æ˜“</button>
                  <button class="filter-tag" data-value="tme" onclick="selectFilter('revenue', 'platform', 'tme', this)">TME</button>
                  <button class="filter-tag" data-value="kugou" onclick="selectFilter('revenue', 'platform', 'kugou', this)">é…·ç‹—</button>
                  <button class="filter-tag" data-value="aiting" onclick="selectFilter('revenue', 'platform', 'aiting', this)">çˆ±å¬</button>
                </div>
              </div>
            </div>

            <!-- ä¸“è¾‘åˆ†ç»„ -->
            <div class="border-b">
              <div class="flex items-center justify-between px-4 py-3 bg-gray-50">
                <span class="text-sm font-medium text-gray-700">ä¸“è¾‘</span>
                <button id="album-expand-btn-revenue" onclick="toggleExpand('revenue', 'album')" class="text-xs text-blue-500 hidden">å±•å¼€</button>
              </div>
              <div id="album-options-revenue" class="px-4 py-3" data-expanded="true">
                <div class="flex flex-wrap gap-2">
                  <button class="filter-tag active" data-value="all" onclick="selectFilter('revenue', 'album', 'all', this)">å…¨éƒ¨</button>
                  <button class="filter-tag" data-value="albumA" onclick="selectFilter('revenue', 'album', 'albumA', this)">ä¸“è¾‘A</button>
                  <button class="filter-tag" data-value="albumB" onclick="selectFilter('revenue', 'album', 'albumB', this)">ä¸“è¾‘B</button>
                  <button class="filter-tag" data-value="albumC" onclick="selectFilter('revenue', 'album', 'albumC', this)">ä¸“è¾‘C</button>
                  <button class="filter-tag" data-value="albumD" onclick="selectFilter('revenue', 'album', 'albumD', this)">ä¸“è¾‘D</button>
                  <button class="filter-tag" data-value="albumE" onclick="selectFilter('revenue', 'album', 'albumE', this)">ä¸“è¾‘E</button>
                  <button class="filter-tag" data-value="albumF" onclick="selectFilter('revenue', 'album', 'albumF', this)">ä¸“è¾‘F</button>
                  <button class="filter-tag" data-value="albumG" onclick="selectFilter('revenue', 'album', 'albumG', this)">ä¸“è¾‘G</button>
                </div>
              </div>
            </div>

            <!-- æ­Œæ›²åˆ†ç»„ -->
            <div class="border-b">
              <div class="flex items-center justify-between px-4 py-3 bg-gray-50">
                <span class="text-sm font-medium text-gray-700">æ­Œæ›²</span>
                <button id="song-expand-btn-revenue" onclick="toggleExpand('revenue', 'song')" class="text-xs text-blue-500 hidden">å±•å¼€</button>
              </div>
              <div id="song-options-revenue" class="px-4 py-3" data-expanded="true">
                <div class="flex flex-wrap gap-2">
                  <button class="filter-tag active" data-value="all" onclick="selectFilter('revenue', 'song', 'all', this)">å…¨éƒ¨</button>
                  <button class="filter-tag" data-value="song1" onclick="selectFilter('revenue', 'song', 'song1', this)">æ˜¥å¤©çš„æ•…äº‹</button>
                  <button class="filter-tag" data-value="song2" onclick="selectFilter('revenue', 'song', 'song2', this)">å¤æ—¥å›å¿†</button>
                  <button class="filter-tag" data-value="song3" onclick="selectFilter('revenue', 'song', 'song3', this)">ç§‹å¤©çš„ç«¥è¯</button>
                  <button class="filter-tag" data-value="song4" onclick="selectFilter('revenue', 'song', 'song4', this)">å†¬æ—¥æš–é˜³</button>
                  <button class="filter-tag" data-value="song5" onclick="selectFilter('revenue', 'song', 'song5', this)">æ˜Ÿç©ºä¸‹çš„çº¦å®š</button>
                  <button class="filter-tag" data-value="song6" onclick="selectFilter('revenue', 'song', 'song6', this)">æœˆå…‰å°å¤œæ›²</button>
                  <button class="filter-tag" data-value="song7" onclick="selectFilter('revenue', 'song', 'song7', this)">æ¢¦æƒ³çš„ç¿…è†€</button>
                </div>
              </div>
            </div>

          </div>

          <!-- åº•éƒ¨å›ºå®šç¡®å®šæŒ‰é’® -->
          <div class="p-4 bg-white border-t">
            <button onclick="applyFilters('revenue')" class="w-full py-3 bg-red-500 text-white rounded-lg font-medium">ç¡®å®š</button>
          </div>

        </div>
      </div>

      <!-- Platform-dist ç­›é€‰æµ®å±‚ -->
      <div id="filter-panel-platform-dist" class="absolute inset-0 bg-black bg-opacity-50 hidden" style="z-index: 200;" onclick="hideFilterPanel('platform-dist')">
        <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl overflow-hidden" onclick="event.stopPropagation()">
          <!-- é¡¶éƒ¨æ‹–åŠ¨æ¡ -->
          <div class="flex justify-center py-2 bg-gray-50">
            <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
          </div>

          <!-- æ ‡é¢˜å’Œé‡ç½® -->
          <div class="flex items-center justify-between px-4 py-3 border-b">
            <span class="font-medium">ç­›é€‰æ¡ä»¶</span>
            <button onclick="resetFilters('platform-dist')" class="text-sm text-red-500">é‡ç½®</button>
          </div>

          <!-- å¯æ»šåŠ¨å†…å®¹åŒºåŸŸ -->
          <div class="max-h-[60vh] overflow-y-auto">

            <!-- å¸ç§åˆ†ç»„ -->
            <div class="border-b">
              <div class="flex items-center justify-between px-4 py-3 bg-gray-50">
                <span class="text-sm font-medium text-gray-700">å¸ç§</span>
              </div>
              <div id="currency-options-platform-dist" class="px-4 py-3">
                <div class="flex flex-wrap gap-2">
                  <button class="filter-tag active" data-value="cny" onclick="selectFilter('platform-dist', 'currency', 'cny', this)">CNY</button>
                  <button class="filter-tag" data-value="eur" onclick="selectFilter('platform-dist', 'currency', 'eur', this)">EUR</button>
                </div>
              </div>
            </div>

          </div>

          <!-- åº•éƒ¨å›ºå®šç¡®å®šæŒ‰é’® -->
          <div class="p-4 bg-white border-t">
            <button onclick="applyFilters('platform-dist')" class="w-full py-3 bg-red-500 text-white rounded-lg font-medium">ç¡®å®š</button>
          </div>

        </div>
      </div>

      <!-- Content ç­›é€‰æµ®å±‚ -->
      <div id="filter-panel-content" class="absolute inset-0 bg-black bg-opacity-50 hidden" style="z-index: 200;" onclick="hideFilterPanel('content')">
        <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl overflow-hidden" onclick="event.stopPropagation()">
          <!-- é¡¶éƒ¨æ‹–åŠ¨æ¡ -->
          <div class="flex justify-center py-2 bg-gray-50">
            <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
          </div>

          <!-- æ ‡é¢˜å’Œé‡ç½® -->
          <div class="flex items-center justify-between px-4 py-3 border-b">
            <span class="font-medium">ç­›é€‰æ¡ä»¶</span>
            <button onclick="resetFilters('content')" class="text-sm text-red-500">é‡ç½®</button>
          </div>

          <!-- å¯æ»šåŠ¨å†…å®¹åŒºåŸŸ -->
          <div class="max-h-[60vh] overflow-y-auto">

            <!-- ä¸“è¾‘åˆ†ç»„ -->
            <div class="border-b">
              <div class="flex items-center justify-between px-4 py-3 bg-gray-50">
                <span class="text-sm font-medium text-gray-700">ä¸“è¾‘</span>
              </div>
              <div id="album-options-content" class="px-4 py-3" data-expanded="true">
                <div class="flex flex-wrap gap-2">
                  <button class="filter-tag active" data-value="all" onclick="selectFilter('content', 'album', 'all', this)">å…¨éƒ¨</button>
                  <button class="filter-tag" data-value="albumA" onclick="selectFilter('content', 'album', 'albumA', this)">ä¸“è¾‘A</button>
                  <button class="filter-tag" data-value="albumB" onclick="selectFilter('content', 'album', 'albumB', this)">ä¸“è¾‘B</button>
                  <button class="filter-tag" data-value="albumC" onclick="selectFilter('content', 'album', 'albumC', this)">ä¸“è¾‘C</button>
                  <button class="filter-tag" data-value="albumD" onclick="selectFilter('content', 'album', 'albumD', this)">ä¸“è¾‘D</button>
                  <button class="filter-tag" data-value="albumE" onclick="selectFilter('content', 'album', 'albumE', this)">ä¸“è¾‘E</button>
                  <button class="filter-tag" data-value="albumF" onclick="selectFilter('content', 'album', 'albumF', this)">ä¸“è¾‘F</button>
                  <button class="filter-tag" data-value="albumG" onclick="selectFilter('content', 'album', 'albumG', this)">ä¸“è¾‘G</button>
                </div>
              </div>
            </div>

            <!-- æ­Œæ›²åˆ†ç»„ -->
            <div class="border-b">
              <div class="flex items-center justify-between px-4 py-3 bg-gray-50">
                <span class="text-sm font-medium text-gray-700">æ­Œæ›²</span>
              </div>
              <div id="song-options-content" class="px-4 py-3" data-expanded="true">
                <div class="flex flex-wrap gap-2">
                  <button class="filter-tag active" data-value="all" onclick="selectFilter('content', 'song', 'all', this)">å…¨éƒ¨</button>
                  <button class="filter-tag" data-value="song1" onclick="selectFilter('content', 'song', 'song1', this)">æ˜¥å¤©çš„æ•…äº‹</button>
                  <button class="filter-tag" data-value="song2" onclick="selectFilter('content', 'song', 'song2', this)">å¤æ—¥å›å¿†</button>
                  <button class="filter-tag" data-value="song3" onclick="selectFilter('content', 'song', 'song3', this)">ç§‹å¤©çš„ç«¥è¯</button>
                  <button class="filter-tag" data-value="song4" onclick="selectFilter('content', 'song', 'song4', this)">å†¬æ—¥æš–é˜³</button>
                  <button class="filter-tag" data-value="song5" onclick="selectFilter('content', 'song', 'song5', this)">æ˜Ÿç©ºä¸‹çš„çº¦å®š</button>
                  <button class="filter-tag" data-value="song6" onclick="selectFilter('content', 'song', 'song6', this)">æœˆå…‰å°å¤œæ›²</button>
                  <button class="filter-tag" data-value="song7" onclick="selectFilter('content', 'song', 'song7', this)">æ¢¦æƒ³çš„ç¿…è†€</button>
                </div>
              </div>
            </div>

          </div>

          <!-- åº•éƒ¨å›ºå®šç¡®å®šæŒ‰é’® -->
          <div class="p-4 bg-white border-t">
            <button onclick="applyFilters('content')" class="w-full py-3 bg-red-500 text-white rounded-lg font-medium">ç¡®å®š</button>
          </div>

        </div>
      </div>

    </div>

    <!-- Tab Bar -->
    <div class="tab-bar bg-white flex items-center justify-around" data-component="tab-bar">
      <button class="flex-1 flex flex-col items-center py-2 text-red-500" onclick="switchPage('works')" id="btn-works" data-type="tab">
        <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z"/></svg>
        <span class="text-xs">ä½œå“ç®¡ç†</span>
      </button>
      <button class="flex-1 flex flex-col items-center py-2 text-gray-400" onclick="switchPage('data')" id="btn-data" data-type="tab">
        <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/></svg>
        <span class="text-xs">æ•°æ®ä¸­å¿ƒ</span>
      </button>
      <button class="flex-1 flex flex-col items-center py-2 text-gray-400" onclick="switchPage('profile')" id="btn-profile" data-type="tab">
        <div class="relative">
          <svg class="w-6 h-6 mb-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/></svg>
          <span class="badge" style="top: -5px; right: -10px;">3</span>
        </div>
        <span class="text-xs">ä¸ªäººä¸­å¿ƒ</span>
      </button>
    </div>

  </div>

  <script>
    // å…¨å±€å˜é‡
    let currentPage = 'works';
    let currentDataTab = 'works';
    let artistTags = [];
    let unreadMessageCount = 3;
    let charts = {};
    let currentContentMetric = 'songs';  // å½“å‰é€‰ä¸­çš„å†…å®¹ç»è¥æŒ‡æ ‡
    let contentTimeRange = 3;  // å½“å‰æ—¶é—´èŒƒå›´ï¼ˆæœˆæ•°ï¼‰

    // å†…å®¹ç»è¥ä¸‹é’»çŠ¶æ€
    const contentDrilldownState = {
      album: 'all',
      song: 'all'
    };

    // æ›´æ–°å¯¼èˆªæ 
    function updateNavbar(title, showBack = false, backHandler = null, rightButton = null) {
      document.getElementById('navbarTitle').textContent = title;
      const navbarLeft = document.getElementById('navbarLeft');
      const navbarRight = document.querySelector('.mp-navbar-right');

      if (showBack) {
        navbarLeft.innerHTML = `
          <div class="mp-btn-back" onclick="${backHandler || 'history.back()'}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </div>
        `;
      } else {
        navbarLeft.innerHTML = '';
      }

      // å¤„ç†å³ä¾§æŒ‰é’®
      if (rightButton) {
        navbarRight.innerHTML = rightButton;
      } else {
        navbarRight.innerHTML = `
          <div class="mp-capsule">
            <span style="font-size: 16px;">Â·Â·Â·</span>
            <span style="font-size: 16px;">â­•</span>
          </div>
        `;
      }
    }

    // é¡µé¢åˆ‡æ¢
    function switchPage(page) {
      // é¦–å…ˆéšè—æ‰€æœ‰å­é¡µé¢ï¼Œé˜²æ­¢å åŠ æ˜¾ç¤º
      const subPages = ['page-messages', 'page-message-detail', 'page-contracts', 'works-form-view', 'page-profile-edit', 'page-account-deletion'];
      subPages.forEach(subPageId => {
        const subPage = document.getElementById(subPageId);
        if (subPage) {
          subPage.classList.add('hidden');
        }
      });

      // å¦‚æœåˆ‡æ¢åˆ°ä½œå“ç®¡ç†ï¼Œæ˜¾ç¤ºä½œå“åˆ—è¡¨è§†å›¾
      if (page === 'works') {
        document.getElementById('works-list-view').classList.remove('hidden');
        document.getElementById('fabCreate').classList.remove('hidden');
      } else {
        document.getElementById('fabCreate').classList.add('hidden');
      }

      const pages = ['works', 'data', 'profile'];
      pages.forEach(p => {
        document.getElementById(`page-${p}`).classList.toggle('hidden', p !== page);
        document.getElementById(`btn-${p}`).classList.toggle('text-red-500', p === page);
        document.getElementById(`btn-${p}`).classList.toggle('text-gray-400', p !== page);
      });
      currentPage = page;

      // æ›´æ–°å¯¼èˆªæ æ ‡é¢˜
      const titles = {
        works: 'ä½œå“ç®¡ç†',
        data: 'æ•°æ®ä¸­å¿ƒ',
        profile: 'ä¸ªäººä¸­å¿ƒ'
      };
      updateNavbar(titles[page], false);

      // åˆå§‹åŒ–å›¾è¡¨(å¦‚æœæ˜¯æ•°æ®ä¸­å¿ƒé¡µ)
      if (page === 'data') {
        setTimeout(() => {
          initCharts();
        }, 100);
      }
    }

    // æ‰‹é£ç´æŠ˜å åˆ‡æ¢
    function toggleAccordion(panelId) {
      const panel = document.getElementById(panelId);
      panel.classList.toggle('collapsed');
    }

    // æ•°æ®ä¸­å¿ƒTabåˆ‡æ¢
    function switchDataTab(tab) {
      const tabs = ['works', 'content', 'fans', 'fire'];
      tabs.forEach(t => {
        document.getElementById(`data-${t}`).classList.toggle('hidden', t !== tab);
        const btn = document.getElementById(`tab-${t}`);
        if (t === tab) {
          btn.classList.add('border-b-2', 'border-red-500', 'text-red-500');
          btn.classList.remove('text-gray-500');
        } else {
          btn.classList.remove('border-b-2', 'border-red-500', 'text-red-500');
          btn.classList.add('text-gray-500');
        }
      });
      currentDataTab = tab;

      // åˆ‡æ¢tabæ—¶é‡ç½®å›¾è¡¨ä¸‹é’»çŠ¶æ€
      if (tab === 'works') {
        resetChartDrilldown('revenue');
      }

      if (tab === 'works' || tab === 'content') {
        setTimeout(() => initCharts(), 100);
      }
    }

    // åˆå§‹åŒ–å›¾è¡¨
    function initCharts() {
      // ç»è¥æƒ…å†µå›¾è¡¨ï¼ˆç»Ÿä¸€ï¼‰
      if (!charts.revenue) {
        const chartRevenue = echarts.init(document.getElementById('chart-revenue'));
        charts.revenue = chartRevenue;
        const optionRevenue = {
          tooltip: { show: false },  // å®Œå…¨ç¦ç”¨ ECharts è‡ªå¸¦ tooltip
          legend: { data: ['æ”¶å…¥', 'æ’­æ”¾é‡', 'é”€å”®é‡', 'ä¸‹è½½é‡'], bottom: 0 },
          grid: { left: '3%', right: '4%', bottom: '15%', containLabel: true },
          xAxis: { type: 'category', data: ['1æœˆ', '2æœˆ', '3æœˆ'] },
          yAxis: [
            { type: 'value', name: 'æ”¶å…¥(Â¥)', position: 'left' },
            { type: 'value', name: 'æ•°é‡', position: 'right' }
          ],
          series: [
            { name: 'æ”¶å…¥', type: 'line', data: [12000, 15000, 18000], yAxisIndex: 0 },
            { name: 'æ’­æ”¾é‡', type: 'bar', data: [120000, 150000, 180000], yAxisIndex: 1 },
            { name: 'é”€å”®é‡', type: 'bar', data: [3200, 4100, 5000], yAxisIndex: 1 },
            { name: 'ä¸‹è½½é‡', type: 'bar', data: [2100, 2800, 3500], yAxisIndex: 1 }
          ]
        };
        chartRevenue.setOption(optionRevenue);

        // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ - æ˜¾ç¤º tooltip
        chartRevenue.on('click', function(params) {
          showChartTooltip('revenue', params, chartRevenue);
        });
      }

      // å¹³å°åˆ†å¸ƒå›¾è¡¨
      if (!charts.platform) {
        const chartPlatform = echarts.init(document.getElementById('chart-platform'));
        charts.platform = chartPlatform;
        const optionPlatform = {
          title: [
            {
              text: 'æ’­æ”¾é‡å æ¯”',
              left: '50%',
              top: '3%',
              textAlign: 'center',
              textStyle: { fontSize: 14, fontWeight: 'normal', color: '#6b7280' }
            },
            {
              text: 'æ”¶å…¥å æ¯”',
              left: '50%',
              top: '52%',
              textAlign: 'center',
              textStyle: { fontSize: 14, fontWeight: 'normal', color: '#6b7280' }
            }
          ],
          tooltip: {
            trigger: 'item',
            formatter: function(params) {
              const seriesName = params.seriesName;
              const name = params.name;
              const value = params.value;
              const percent = params.percent;
              const unit = seriesName.includes('æ’­æ”¾') ? 'æ¬¡' : 'å…ƒ';
              const actualValue = seriesName.includes('æ’­æ”¾') ? value * 1000 : value * 1000;
              return `${name}<br/>${seriesName}: ${actualValue.toLocaleString()}${unit} (${percent}%)`;
            }
          },
          legend: { bottom: 10, orient: 'horizontal' },
          series: [
            {
              name: 'æ’­æ”¾é‡å æ¯”',
              type: 'pie',
              radius: '35%',
              center: ['50%', '28%'],
              label: {
                show: true,
                formatter: function(params) {
                  return `${params.name}\n${(params.value * 1000).toLocaleString()}æ¬¡\n(${params.percent}%)`;
                },
                position: 'outside'
              },
              labelLine: { show: true, length: 8, length2: 12 },
              data: [
                { value: 35, name: 'ç½‘æ˜“' },
                { value: 30, name: 'TME' },
                { value: 20, name: 'é…·ç‹—' },
                { value: 15, name: 'çˆ±å¬' }
              ]
            },
            {
              name: 'æ”¶å…¥å æ¯”',
              type: 'pie',
              radius: '35%',
              center: ['50%', '72%'],
              label: {
                show: true,
                formatter: function(params) {
                  return `${params.name}\nÂ¥${(params.value * 1000).toLocaleString()}\n(${params.percent}%)`;
                },
                position: 'outside'
              },
              labelLine: { show: true, length: 8, length2: 12 },
              data: [
                { value: 40, name: 'ç½‘æ˜“' },
                { value: 28, name: 'TME' },
                { value: 18, name: 'é…·ç‹—' },
                { value: 14, name: 'çˆ±å¬' }
              ]
            }
          ]
        };
        chartPlatform.setOption(optionPlatform);
      }

      // å†…å®¹ç»è¥å›¾è¡¨
      if (currentDataTab === 'content' && !charts.content) {
        const chartContent = echarts.init(document.getElementById('chart-content'));
        charts.content = chartContent;
        updateContentChart('songs');
      }
    }

    // ç”Ÿæˆå†…å®¹ç»è¥æ•°æ®
    function generateContentData(months, metric) {
      const granularity = metric === 'songs' ? 'month' : 'day';
      const xAxisData = [];
      const seriesData = [];

      if (granularity === 'month') {
        // æ­Œæ›²å‘å¸ƒæ•°ï¼šæŒ‰æœˆ
        for (let i = months; i > 0; i--) {
          const date = new Date();
          date.setMonth(date.getMonth() - i + 1);
          const year = date.getFullYear() % 100;  // è·å–å¹´ä»½åä¸¤ä½
          xAxisData.push(`${year}å¹´${date.getMonth() + 1}æœˆ`);
          seriesData.push(Math.floor(1 + Math.random() * 5));  // 1-6é¦–æ­Œ
        }
      } else {
        // å…¶ä»–æŒ‡æ ‡ï¼šæŒ‰æ—¥ï¼ˆæ¯æœˆå–5ä¸ªé‡‡æ ·ç‚¹ï¼‰
        const daysPerMonth = 5;
        for (let i = months; i > 0; i--) {
          for (let j = 0; j < daysPerMonth; j++) {
            const date = new Date();
            date.setMonth(date.getMonth() - i + 1);
            date.setDate((j + 1) * 6);  // æ¯6å¤©ä¸€ä¸ªæ•°æ®ç‚¹
            const year = date.getFullYear() % 100;  // è·å–å¹´ä»½åä¸¤ä½
            xAxisData.push(`${year}å¹´${date.getMonth() + 1}/${date.getDate()}`);

            // æ ¹æ®æŒ‡æ ‡ç±»å‹ç”Ÿæˆä¸åŒèŒƒå›´çš„æ•°æ®
            if (metric === 'plays') {
              seriesData.push(Math.floor(100000 + Math.random() * 100000));
            } else if (metric === 'likes') {
              seriesData.push(Math.floor(3000 + Math.random() * 3000));
            } else {  // comments
              seriesData.push(Math.floor(800 + Math.random() * 700));
            }
          }
        }
      }

      return { xAxisData, seriesData };
    }

    // æ›´æ–°å†…å®¹ç»è¥å›¾è¡¨
    function updateContentChart() {
      const metricsInfo = {
        songs: { title: 'æ­Œæ›²æ•°' },
        plays: { title: 'ç‚¹æ’­æ•°' },
        likes: { title: 'ç‚¹èµæ•°' },
        comments: { title: 'è¯„è®ºæ•°' }
      };

      const info = metricsInfo[currentContentMetric];
      document.getElementById('selectedMetricTitle').textContent = info.title + 'è¶‹åŠ¿';

      // ç”Ÿæˆæ•°æ®
      const { xAxisData, seriesData } = generateContentData(contentTimeRange, currentContentMetric);

      // æ ¹æ®ä¸‹é’»çŠ¶æ€è°ƒæ•´æ•°æ®
      const state = contentDrilldownState;
      const multiplier = state.album === 'all' ? 1 :
                        state.song === 'all' ? 0.6 : 0.3;

      const adjustedData = seriesData.map(val => Math.floor(val * multiplier));

      const option = {
        tooltip: { trigger: 'axis' },
        grid: { left: '3%', right: '4%', bottom: '10%', containLabel: true },
        xAxis: {
          type: 'category',
          data: xAxisData,
          axisLabel: { rotate: currentContentMetric !== 'songs' ? 45 : 0, fontSize: 10 }
        },
        yAxis: { type: 'value' },
        series: [{
          name: info.title,
          type: 'line',
          data: adjustedData,
          smooth: true,
          itemStyle: { color: '#F93B3D' }
        }]
      };

      if (charts.content) {
        charts.content.setOption(option);
      }
    }

    // æŒ‡æ ‡å¡é€‰æ‹©
    function selectMetric(metric) {
      currentContentMetric = metric;

      // æ›´æ–°å•é€‰æŒ‰é’®çŠ¶æ€
      document.querySelectorAll('input[name="content-metric"]').forEach(radio => {
        radio.checked = (radio.value === metric);
      });

      // é‡ç½®ä¸‹é’»çŠ¶æ€
      resetContentDrilldown();

      // æ›´æ–°å›¾è¡¨
      updateContentChart();
    }

    // å†…å®¹ç»è¥æ—¶é—´èŒƒå›´æ›´æ–°
    function updateContentTimeRange(months, button) {
      contentTimeRange = months;

      // æ›´æ–°æŒ‰é’®æ ·å¼
      const container = document.getElementById('content-time-filter');
      container.querySelectorAll('.chip').forEach(btn => {
        btn.classList.remove('active');
      });
      button.classList.add('active');

      // æ›´æ–°å›¾è¡¨
      updateContentChart();
    }

    // ä¸“è¾‘é€‰æ‹©å¤„ç†
    function handleContentAlbumChange(album) {
      contentDrilldownState.album = album;
      contentDrilldownState.song = 'all';

      updateContentBreadcrumb();

      // å¯ç”¨/ç¦ç”¨æ­Œæ›²ä¸‹æ‹‰æ¡†
      const songSelect = document.getElementById('content-song-select');
      if (album !== 'all') {
        songSelect.disabled = false;
        songSelect.value = 'all';
      } else {
        songSelect.disabled = true;
        songSelect.value = 'all';
      }

      updateContentChart();
    }

    // æ­Œæ›²é€‰æ‹©å¤„ç†
    function handleContentSongChange(song) {
      contentDrilldownState.song = song;
      updateContentBreadcrumb();
      updateContentChart();
    }

    // æ›´æ–°é¢åŒ…å±‘
    function updateContentBreadcrumb() {
      const breadcrumb = document.getElementById('content-breadcrumb');
      const state = contentDrilldownState;

      const albumNames = {
        all: 'å…¨éƒ¨ä¸“è¾‘',
        albumA: 'ä¸“è¾‘A',
        albumB: 'ä¸“è¾‘B'
      };

      const songNames = {
        all: 'å…¨éƒ¨æ­Œæ›²',
        song1: 'æ˜¥å¤©çš„æ•…äº‹',
        song2: 'å¤æ—¥å›å¿†'
      };

      let html = '<span class="breadcrumb-item" onclick="resetContentDrilldown()">å…¨éƒ¨æ•°æ®</span>';

      if (state.album !== 'all') {
        html += '<span class="breadcrumb-separator">></span>';
        html += `<span class="breadcrumb-item">${albumNames[state.album]}</span>`;
      }

      if (state.song !== 'all') {
        html += '<span class="breadcrumb-separator">></span>';
        html += `<span class="breadcrumb-item">${songNames[state.song]}</span>`;
      }

      breadcrumb.innerHTML = html;
    }

    // é‡ç½®å†…å®¹ç»è¥ä¸‹é’»
    function resetContentDrilldown() {
      contentDrilldownState.album = 'all';
      contentDrilldownState.song = 'all';

      // é‡ç½®ç­›é€‰çŠ¶æ€
      if (filterState.content) {
        filterState.content.album = 'all';
        filterState.content.song = 'all';
      }

      updateContentChart();
    }

    // ä½œå“ç®¡ç†ç›¸å…³
    function toggleAlbumGroup(element) {
      element.parentElement.classList.toggle('collapsed');
    }

    // æœç´¢å’Œç­›é€‰ä½œå“
    function filterSongs() {
      const searchValue = document.getElementById('searchInput').value.toLowerCase();
      const albumFilter = document.getElementById('albumFilter').value;
      const statusFilter = document.getElementById('statusFilter').value;

      const songItems = document.querySelectorAll('.song-item');
      const albumGroups = document.querySelectorAll('.album-group');
      let visibleCount = 0;

      // éå†æ‰€æœ‰æ­Œæ›²
      songItems.forEach(item => {
        const songName = item.querySelector('.font-medium').textContent.toLowerCase();
        const songStatus = item.getAttribute('data-status');

        // è·å–æ­Œæ›²æ‰€å±ä¸“è¾‘
        let songAlbum = '';
        const albumGroup = item.closest('.album-group');
        if (albumGroup) {
          songAlbum = albumGroup.getAttribute('data-album');
        }

        // åˆ¤æ–­æ˜¯å¦åŒ¹é…æœç´¢æ¡ä»¶
        const matchSearch = songName.includes(searchValue);
        const matchAlbum = !albumFilter || songAlbum === albumFilter;
        const matchStatus = !statusFilter || songStatus === statusFilter;

        // æ˜¾ç¤ºæˆ–éšè—æ­Œæ›²
        if (matchSearch && matchAlbum && matchStatus) {
          item.style.display = 'flex';
          visibleCount++;
        } else {
          item.style.display = 'none';
        }
      });

      // å¤„ç†ä¸“è¾‘ç»„çš„æ˜¾ç¤º/éšè—
      albumGroups.forEach(group => {
        const visibleSongs = group.querySelectorAll('.song-item[style*="display: flex"]');
        if (visibleSongs.length > 0) {
          group.style.display = 'block';
        } else {
          group.style.display = 'none';
        }
      });

      // æ˜¾ç¤º/éšè—ç©ºçŠ¶æ€
      const emptyState = document.getElementById('emptyState');
      const songListContainer = document.getElementById('songListContainer');

      if (visibleCount === 0) {
        emptyState.classList.remove('hidden');
        songListContainer.style.display = 'none';
      } else {
        emptyState.classList.add('hidden');
        songListContainer.style.display = 'block';
      }
    }

    // ç»‘å®šæœç´¢å’Œç­›é€‰äº‹ä»¶
    document.addEventListener('DOMContentLoaded', () => {
      const searchInput = document.getElementById('searchInput');
      const albumFilter = document.getElementById('albumFilter');
      const statusFilter = document.getElementById('statusFilter');

      if (searchInput) {
        searchInput.addEventListener('input', filterSongs);
      }
      if (albumFilter) {
        albumFilter.addEventListener('change', filterSongs);
      }
      if (statusFilter) {
        statusFilter.addEventListener('change', filterSongs);
      }

      // åˆå§‹åŒ–ç­›é€‰å™¨æ ‡ç­¾äº‹ä»¶ç›‘å¬
      initFilterTagListeners();
    });

    // åˆå§‹åŒ–ç­›é€‰å™¨æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
    function initFilterTagListeners() {
      // åˆå§‹åŒ–å„é¢æ¿çš„äº‹ä»¶ç›‘å¬
      ['revenue', 'platform-dist', 'content'].forEach(currency => {
        // æ·»åŠ æµ®å±‚èƒŒæ™¯ç‚¹å‡»å…³é—­äº‹ä»¶
        const panel = document.getElementById(`filter-panel-${currency}`);
        if (panel) {
          panel.addEventListener('click', function(e) {
            if (e.target === this) {
              hideFilterPanel(currency);
            }
          });
        }
      });

      // revenue ä¸“ç”¨çš„ tooltip ç‚¹å‡»äº‹ä»¶ç›‘å¬ï¼ˆä¸‹é’»é“¾æ¥ï¼‰
      const currency = 'revenue';

      // æ·»åŠ  tooltip ç‚¹å‡»äº‹ä»¶ç›‘å¬ï¼ˆä¸‹é’»é“¾æ¥ï¼‰
      const tooltip = document.getElementById(`chart-tooltip-${currency}`);
      if (tooltip) {
        tooltip.addEventListener('click', function(e) {
          const link = e.target.closest('.tooltip-drilldown-link');
          if (link) {
            const chartCurrency = link.dataset.currency;
            const level = link.dataset.level;
            const params = JSON.parse(this.dataset.clickParams);

            if (level === 'platform') {
              drillDownToPlatform(chartCurrency, params);
            } else if (level === 'song') {
              drillDownToSong(chartCurrency, params);
            }

            hideChartTooltip(chartCurrency);
          }
          e.stopPropagation();
        });
      }

      // æ·»åŠ ç‚¹å‡»å›¾è¡¨å¤–å…³é—­ tooltip
      const mainContent = document.getElementById('mainContent');
      if (mainContent) {
        mainContent.addEventListener('click', function(e) {
          const isChartClick = e.target.closest('.chart-container');
          const isTooltipClick = e.target.closest('[id^="chart-tooltip-"]');
          const isFilterPanelClick = e.target.closest('[id^="filter-panel-"]');

          if (!isChartClick && !isTooltipClick && !isFilterPanelClick) {
            hideChartTooltip('revenue');
          }
        });
      }
    }

    function showCreateSong() {
      document.getElementById('works-list-view').classList.add('hidden');
      document.getElementById('works-form-view').classList.remove('hidden');
      document.getElementById('fabCreate').classList.add('hidden');
      updateNavbar('ä¸Šä¼ æ–°ä½œ', true, 'showWorksList()');
      resetSongForm();
    }

    function editSong(id) {
      document.getElementById('works-list-view').classList.add('hidden');
      document.getElementById('works-form-view').classList.remove('hidden');
      document.getElementById('fabCreate').classList.add('hidden');
      updateNavbar('ç¼–è¾‘ä½œå“', true, 'showWorksList()');
      // å¡«å……è¡¨å•æ•°æ®(ç¤ºä¾‹)
      document.getElementById('songName').value = 'æ˜¥å¤©çš„æ•…äº‹';
      document.getElementById('albumName').value = 'ä¸“è¾‘A';
      document.getElementById('artistInput').value = 'åˆä½œè‰ºäººA, åˆä½œè‰ºäººB';
      updateArtistPreview();
    }

    function showWorksList() {
      document.getElementById('works-list-view').classList.remove('hidden');
      document.getElementById('works-form-view').classList.add('hidden');
      document.getElementById('fabCreate').classList.remove('hidden');
      updateNavbar('ä½œå“ç®¡ç†', false);
    }

    function resetSongForm() {
      document.getElementById('songForm').reset();
      document.getElementById('fileInfo').textContent = '';
      document.getElementById('uploadProgress').classList.add('hidden');
      document.getElementById('newAlbumInput').classList.add('hidden');
      document.getElementById('artistPreview').textContent = '';
    }

    // ä¸“è¾‘é€‰æ‹©å¤„ç†
    function handleAlbumChange(select) {
      const newAlbumInput = document.getElementById('newAlbumInput');
      if (select.value === 'æ–°å»º') {
        newAlbumInput.classList.remove('hidden');
        document.getElementById('newAlbumName').focus();
      } else {
        newAlbumInput.classList.add('hidden');
      }
    }

    // åˆä½œè‰ºäººè¾“å…¥å¤„ç†(é€—å·åˆ†éš”)
    function updateArtistPreview() {
      const input = document.getElementById('artistInput').value;
      const preview = document.getElementById('artistPreview');
      if (input.trim()) {
        const artists = input.split(/[,ã€]/).map(a => a.trim()).filter(a => a);
        if (artists.length > 0) {
          preview.textContent = `å·²è¯†åˆ« ${artists.length} ä½è‰ºäºº: ${artists.join(', ')}`;
        } else {
          preview.textContent = '';
        }
      } else {
        preview.textContent = '';
      }
    }

    // ç›‘å¬è‰ºäººè¾“å…¥å®æ—¶æ›´æ–°
    document.addEventListener('DOMContentLoaded', () => {
      const artistInput = document.getElementById('artistInput');
      if (artistInput) {
        artistInput.addEventListener('input', updateArtistPreview);
      }
    });

    // æ–‡ä»¶ä¸Šä¼ å¤„ç†
    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      const fileInfo = document.getElementById('fileInfo');
      const uploadProgress = document.getElementById('uploadProgress');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const maxSize = 100 * 1024 * 1024; // 100MB
      const allowedTypes = ['audio/mpeg', 'audio/wav', 'audio/mp3'];

      if (!allowedTypes.includes(file.type) && !file.name.match(/\.(mp3|wav)$/i)) {
        fileInfo.innerHTML = '<span class="text-red-500">âŒ æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ,ä»…æ”¯æŒ MP3ã€WAV</span>';
        uploadProgress.classList.add('hidden');
        event.target.value = '';
        return;
      }

      if (file.size > maxSize) {
        fileInfo.innerHTML = '<span class="text-red-500">âŒ æ–‡ä»¶å¤§å°è¶…è¿‡100MBé™åˆ¶</span>';
        uploadProgress.classList.add('hidden');
        event.target.value = '';
        return;
      }

      // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
      fileInfo.innerHTML = `<span class="text-red-500">ğŸ“ ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB)</span>`;

      // æ¨¡æ‹Ÿä¸Šä¼ è¿›åº¦
      uploadProgress.classList.remove('hidden');
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
          progress = 100;
          clearInterval(interval);
          progressText.textContent = 'ä¸Šä¼ å®Œæˆ 100%';
          fileInfo.innerHTML = `<span class="text-green-500">âœ… ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB) - å·²å°±ç»ª</span>`;
        } else {
          progressText.textContent = `ä¸Šä¼ ä¸­... ${Math.floor(progress)}%`;
        }
        progressFill.style.width = progress + '%';
      }, 200);
    }

    // æäº¤ä½œå“è¡¨å•
    function submitSongForm() {
      const songName = document.getElementById('songName').value;
      const songFile = document.getElementById('songFile').files[0];

      if (!songName) {
        showToast('è¯·è¾“å…¥æ­Œæ›²åç§°');
        return;
      }

      if (!songFile) {
        showToast('è¯·ä¸Šä¼ æ­Œæ›²æ–‡ä»¶');
        return;
      }

      // æ¨¡æ‹Ÿæäº¤
      showToast('ä½œå“æäº¤æˆåŠŸ!ç­‰å¾…å®¡æ ¸...');
      showWorksList();
    }

    // æ¶ˆæ¯ç›¸å…³
    function showMessages() {
      document.getElementById('page-profile').classList.add('hidden');
      document.getElementById('page-messages').classList.remove('hidden');
      const markAllBtn = `
        <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 active:bg-gray-200" onclick="markAllRead()" title="å…¨éƒ¨å·²è¯»">
          <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7m-7 6l4 4 8-8"/>
          </svg>
        </button>
        <div class="mp-capsule">
          <span style="font-size: 16px;">Â·Â·Â·</span>
          <span style="font-size: 16px;">â­•</span>
        </div>
      `;
      updateNavbar('æ¶ˆæ¯é€šçŸ¥', true, 'backToProfile()', markAllBtn);
    }

    function backToProfile() {
      document.getElementById('page-profile').classList.remove('hidden');
      document.getElementById('page-messages').classList.add('hidden');
      document.getElementById('page-contracts').classList.add('hidden');
      updateNavbar('ä¸ªäººä¸­å¿ƒ', false);
    }

    function markAllRead() {
      const messages = document.querySelectorAll('.message-item[data-read="false"]');
      messages.forEach(msg => {
        msg.setAttribute('data-read', 'true');
        msg.classList.add('opacity-60');
        const dot = msg.querySelector('.bg-red-500');
        if (dot) dot.classList.remove('bg-red-500');
      });
      unreadMessageCount = 0;
      updateBadges();
    }

    function showMessageDetail(id) {
      document.getElementById('page-messages').classList.add('hidden');
      document.getElementById('page-message-detail').classList.remove('hidden');
      updateNavbar('æ¶ˆæ¯è¯¦æƒ…', true, 'backToMessages()');
      // æ ‡è®°ä¸ºå·²è¯»
      const msgItem = event.currentTarget;
      if (msgItem.getAttribute('data-read') === 'false') {
        msgItem.setAttribute('data-read', 'true');
        msgItem.classList.add('opacity-60');
        const dot = msgItem.querySelector('.bg-red-500');
        if (dot) dot.classList.remove('bg-red-500');
        unreadMessageCount = Math.max(0, unreadMessageCount - 1);
        updateBadges();
      }
    }

    function backToMessages() {
      document.getElementById('page-messages').classList.remove('hidden');
      document.getElementById('page-message-detail').classList.add('hidden');

      const markAllBtn = `
        <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 active:bg-gray-200" onclick="markAllRead()" title="å…¨éƒ¨å·²è¯»">
          <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7m-7 6l4 4 8-8"/>
          </svg>
        </button>
        <div class="mp-capsule">
          <span style="font-size: 16px;">Â·Â·Â·</span>
          <span style="font-size: 16px;">â­•</span>
        </div>
      `;
      updateNavbar('æ¶ˆæ¯é€šçŸ¥', true, 'backToProfile()', markAllBtn);
    }

    function updateBadges() {
      const badges = document.querySelectorAll('.badge');
      badges.forEach(badge => {
        if (unreadMessageCount > 0) {
          badge.textContent = unreadMessageCount;
          badge.style.display = 'block';
        } else {
          badge.style.display = 'none';
        }
      });
    }

    // åˆåŒæŸ¥çœ‹
    function showContracts() {
      document.getElementById('page-profile').classList.add('hidden');
      document.getElementById('page-contracts').classList.remove('hidden');
      updateNavbar('æˆ‘çš„ç­¾çº¦', true, 'backToProfile()');
    }

    // ä¸ªäººèµ„æ–™ç¼–è¾‘
    function editProfile() {
      document.getElementById('page-profile').classList.add('hidden');
      document.getElementById('page-profile-edit').classList.remove('hidden');
      updateNavbar('ä¸ªäººèµ„æ–™', true, 'backToProfileFromEdit()');
    }

    // è¿”å›ä¸ªäººä¸­å¿ƒ
    function backToProfileFromEdit() {
      document.getElementById('page-profile-edit').classList.add('hidden');
      document.getElementById('page-profile').classList.remove('hidden');
      updateNavbar('ä¸ªäººä¸­å¿ƒ', false);
    }

    // ä¸Šä¼ å¤´åƒ
    function uploadAvatar() {
      // æ¨¡æ‹Ÿé€‰æ‹©ç…§ç‰‡/æ‹ç…§
      const options = ['æ‹ç…§', 'ä»ç›¸å†Œé€‰æ‹©', 'å–æ¶ˆ'];
      const choice = prompt('é€‰æ‹©ä¸Šä¼ æ–¹å¼ï¼š\n1. æ‹ç…§\n2. ä»ç›¸å†Œé€‰æ‹©\n3. å–æ¶ˆ\n\nè¯·è¾“å…¥æ•°å­—é€‰æ‹©ï¼š');
      if (choice === '1') {
        showToast('è°ƒç”¨ç›¸æœºæ‹ç…§(å¾®ä¿¡API: wx.chooseMedia)');
      } else if (choice === '2') {
        showToast('æ‰“å¼€ç›¸å†Œé€‰æ‹©(å¾®ä¿¡API: wx.chooseMedia)');
      }
    }

    // æ€§åˆ«é€‰æ‹©ç›¸å…³
    let selectedGender = 'ç”·';

    function showGenderPicker() {
      document.getElementById('gender-picker-modal').classList.remove('hidden');
      // åˆå§‹åŒ–é€‰ä¸­çŠ¶æ€
      const currentGender = document.getElementById('gender-display').textContent;
      selectGender(currentGender);
    }

    function hideGenderPicker() {
      document.getElementById('gender-picker-modal').classList.add('hidden');
    }

    function selectGender(gender) {
      selectedGender = gender;
      // æ¸…é™¤æ‰€æœ‰å‹¾é€‰æ ‡è®°
      document.getElementById('check-male').classList.add('hidden');
      document.getElementById('check-female').classList.add('hidden');
      document.getElementById('check-other').classList.add('hidden');

      // æ˜¾ç¤ºå½“å‰é€‰ä¸­çš„å‹¾é€‰æ ‡è®°
      if (gender === 'ç”·') {
        document.getElementById('check-male').classList.remove('hidden');
      } else if (gender === 'å¥³') {
        document.getElementById('check-female').classList.remove('hidden');
      } else {
        document.getElementById('check-other').classList.remove('hidden');
      }
    }

    function confirmGender() {
      document.getElementById('gender-display').textContent = selectedGender;
      hideGenderPicker();
      showSaveSuccessTip();
    }

    // æ—¶é—´æ®µé€‰æ‹©å™¨ç›¸å…³å˜é‡å’Œå‡½æ•°
    let pickerState = {
      startYear: 2024,
      startMonth: 1,
      endYear: 2024,
      endMonth: 4,
      currentMode: 'start' // 'start' æˆ– 'end'
    };

    function showPeriodPicker() {
      // æ˜¾ç¤ºæµ®å±‚
      document.getElementById('period-picker-modal').classList.remove('hidden');

      // é»˜è®¤é€‰æ‹©å¼€å§‹æ—¶é—´æ¨¡å¼
      pickerState.currentMode = 'start';
      updateTimeModeUI();

      // åˆå§‹åŒ–æ»šåŠ¨é€‰æ‹©å™¨
      const yearScroller = document.getElementById('year-scroller');
      const monthScroller = document.getElementById('month-scroller');

      initScrollPicker(yearScroller, pickerState.startYear);
      initScrollPicker(monthScroller, String(pickerState.startMonth).padStart(2, '0'));
    }

    function hidePeriodPicker() {
      document.getElementById('period-picker-modal').classList.add('hidden');
    }

    function initScrollPicker(scroller, selectedValue) {
      const items = scroller.querySelectorAll('.picker-item');
      const itemHeight = 40;

      // æ‰¾åˆ°é€‰ä¸­é¡¹çš„ç´¢å¼•
      let selectedIndex = 0;
      items.forEach((item, index) => {
        if (item.dataset.value == selectedValue) {
          selectedIndex = index;
          item.classList.add('selected');
        } else {
          item.classList.remove('selected');
        }
      });

      // æ»šåŠ¨åˆ°é€‰ä¸­ä½ç½®
      scroller.scrollTop = selectedIndex * itemHeight;

      // ç§»é™¤æ—§çš„ç›‘å¬å™¨(å¦‚æœæœ‰)
      scroller.onscroll = null;

      // ç›‘å¬æ»šåŠ¨äº‹ä»¶
      let scrollTimer;
      scroller.addEventListener('scroll', function() {
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(() => {
          updatePickerSelection(scroller);
        }, 150);
      });
    }

    function updatePickerSelection(scroller) {
      const items = scroller.querySelectorAll('.picker-item');
      const itemHeight = 40;
      const scrollTop = scroller.scrollTop;

      // è®¡ç®—å½“å‰å±…ä¸­çš„item
      const centerIndex = Math.round(scrollTop / itemHeight);

      // æ›´æ–°é€‰ä¸­æ ·å¼
      items.forEach((item, index) => {
        item.classList.remove('selected');
        if (index === centerIndex) {
          item.classList.add('selected');

          // æ›´æ–°çŠ¶æ€
          const value = item.dataset.value;
          if (scroller.id === 'year-scroller') {
            if (pickerState.currentMode === 'start') {
              pickerState.startYear = parseInt(value);
            } else {
              pickerState.endYear = parseInt(value);
            }
          } else if (scroller.id === 'month-scroller') {
            if (pickerState.currentMode === 'start') {
              pickerState.startMonth = parseInt(value);
            } else {
              pickerState.endMonth = parseInt(value);
            }
          }

          // æ›´æ–°æ˜¾ç¤º
          updateCurrentDisplay();
        }
      });

      // å¹³æ»‘æ»šåŠ¨åˆ°å‡†ç¡®ä½ç½®
      scroller.scrollTo({
        top: centerIndex * itemHeight,
        behavior: 'smooth'
      });
    }

    function updateCurrentDisplay() {
      const mode = pickerState.currentMode;
      const year = mode === 'start' ? pickerState.startYear : pickerState.endYear;
      const month = mode === 'start' ? pickerState.startMonth : pickerState.endMonth;

      const displayId = mode === 'start' ? 'start-display' : 'end-display';
      document.getElementById(displayId).textContent = `${year}.${String(month).padStart(2, '0')}`;
    }

    function switchTimeMode(mode) {
      pickerState.currentMode = mode;
      updateTimeModeUI();

      // æ›´æ–°æ»šåŠ¨é€‰æ‹©å™¨åˆ°å¯¹åº”æ—¶é—´
      const yearScroller = document.getElementById('year-scroller');
      const monthScroller = document.getElementById('month-scroller');

      const year = mode === 'start' ? pickerState.startYear : pickerState.endYear;
      const month = mode === 'start' ? pickerState.startMonth : pickerState.endMonth;

      initScrollPicker(yearScroller, year);
      initScrollPicker(monthScroller, String(month).padStart(2, '0'));
    }

    function updateTimeModeUI() {
      const startTab = document.getElementById('start-time-tab');
      const endTab = document.getElementById('end-time-tab');

      // ç§»é™¤ä¸¤ä¸ªæ ‡ç­¾çš„activeç±»
      startTab.classList.remove('active');
      endTab.classList.remove('active');

      // æ ¹æ®å½“å‰æ¨¡å¼æ·»åŠ activeç±»
      if (pickerState.currentMode === 'start') {
        startTab.classList.add('active');
      } else {
        endTab.classList.add('active');
      }
    }

    function confirmPeriod() {
      // æ„é€ æ—¥æœŸå­—ç¬¦ä¸²
      const startDate = `${pickerState.startYear}-${String(pickerState.startMonth).padStart(2, '0')}`;
      const endDate = `${pickerState.endYear}-${String(pickerState.endMonth).padStart(2, '0')}`;

      // éªŒè¯:ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´
      if (endDate < startDate) {
        alert('ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´');
        return;
      }

      // æ›´æ–°ä¸»ç•Œé¢æ˜¾ç¤º
      document.getElementById('period-display').textContent = `${startDate} è‡³ ${endDate}`;

      // å…³é—­æµ®å±‚
      hidePeriodPicker();

      // æ›´æ–°å›¾è¡¨
      updatePlatformChart(startDate, endDate);
    }

    function updatePlatformChart(startDate, endDate) {
      // æ ¹æ®é€‰æ‹©çš„æ—¶é—´æ®µæ›´æ–°å¹³å°åˆ†å¸ƒå›¾è¡¨
      if (!charts.platform) return;

      // è®¡ç®—æœˆä»½è·¨åº¦(ç”¨äºæ¨¡æ‹Ÿä¸åŒæ—¶é—´æ®µçš„æ•°æ®)
      const monthDiff = (new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24 * 30);
      const factor = 1 + (monthDiff / 12); // æ—¶é—´æ®µè¶Šé•¿,æ•°æ®è¶Šå¤§

      // æ›´æ–°é¥¼å›¾æ•°æ®
      const optionPlatform = {
        tooltip: {
          trigger: 'item',
          formatter: '{b}: {c} ({d}%)'
        },
        legend: {
          orient: 'horizontal',
          bottom: 0,
          data: ['Spotify', 'Apple Music', 'QQéŸ³ä¹', 'ç½‘æ˜“äº‘éŸ³ä¹', 'YouTube Music']
        },
        series: [
          {
            name: 'æ’­æ”¾é‡å æ¯”',
            type: 'pie',
            radius: ['0%', '40%'],
            center: ['50%', '45%'],
            label: {
              position: 'inner',
              formatter: '{d}%'
            },
            data: [
              { value: Math.round(335000 * factor), name: 'Spotify' },
              { value: Math.round(234000 * factor), name: 'Apple Music' },
              { value: Math.round(154000 * factor), name: 'QQéŸ³ä¹' },
              { value: Math.round(135000 * factor), name: 'ç½‘æ˜“äº‘éŸ³ä¹' },
              { value: Math.round(128000 * factor), name: 'YouTube Music' }
            ]
          },
          {
            name: 'æ”¶å…¥å æ¯”',
            type: 'pie',
            radius: ['55%', '70%'],
            center: ['50%', '45%'],
            label: {
              formatter: '{b}\n{d}%'
            },
            data: [
              { value: Math.round(28500 * factor), name: 'Spotify' },
              { value: Math.round(23400 * factor), name: 'Apple Music' },
              { value: Math.round(18500 * factor), name: 'QQéŸ³ä¹' },
              { value: Math.round(15400 * factor), name: 'ç½‘æ˜“äº‘éŸ³ä¹' },
              { value: Math.round(12800 * factor), name: 'YouTube Music' }
            ]
          }
        ]
      };

      charts.platform.setOption(optionPlatform, true);
    }

    // å•ä¸ªå­—æ®µä¿å­˜æç¤º
    function saveField(fieldName) {
      showSaveSuccessTip();
    }

    // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤ºï¼ˆæ·¡å…¥æ·¡å‡ºï¼‰
    function showSaveSuccessTip() {
      const tip = document.getElementById('save-success-tip');
      tip.style.opacity = '1';

      setTimeout(() => {
        tip.style.opacity = '0';
      }, 1500);
    }

    // å¤åˆ¶UID
    function copyUID() {
      const uid = document.getElementById('uid-text').textContent;

      // åˆ›å»ºä¸´æ—¶textareaç”¨äºå¤åˆ¶
      const textarea = document.createElement('textarea');
      textarea.value = uid;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();

      try {
        document.execCommand('copy');
        showToast('UIDå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      } catch (err) {
        // å¦‚æœexecCommandä¸æ”¯æŒï¼Œä½¿ç”¨æ–°çš„Clipboard API
        if (navigator.clipboard) {
          navigator.clipboard.writeText(uid).then(() => {
            showToast('UIDå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
          }).catch(() => {
            showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
          });
        } else {
          showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
        }
      }

      document.body.removeChild(textarea);
    }

    // æ‰‹æœºç»‘å®šç›¸å…³
    let verifyCodeCountdown = 0;

    function showPhoneBinding() {
      document.getElementById('phone-binding-modal').classList.remove('hidden');
    }

    function hidePhoneBinding() {
      document.getElementById('phone-binding-modal').classList.add('hidden');
    }

    function sendVerifyCode() {
      const phone = document.getElementById('new-phone-input').value;
      if (!phone || phone.length !== 11) {
        showToast('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
        return;
      }

      // æ¨¡æ‹Ÿå‘é€éªŒè¯ç 
      showToast(`éªŒè¯ç å·²å‘é€åˆ° ${phone}`);

      // å€’è®¡æ—¶60ç§’
      verifyCodeCountdown = 60;
      const btn = document.getElementById('send-code-btn');
      btn.disabled = true;
      btn.classList.add('opacity-50');

      const timer = setInterval(() => {
        verifyCodeCountdown--;
        btn.textContent = `${verifyCodeCountdown}ç§’åé‡å‘`;

        if (verifyCodeCountdown <= 0) {
          clearInterval(timer);
          btn.disabled = false;
          btn.classList.remove('opacity-50');
          btn.textContent = 'å‘é€éªŒè¯ç ';
        }
      }, 1000);
    }

    function confirmPhoneBinding() {
      const phone = document.getElementById('new-phone-input').value;
      const code = document.getElementById('verify-code-input').value;

      if (!phone || phone.length !== 11) {
        showToast('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
        return;
      }

      if (!code || code.length !== 6) {
        showToast('è¯·è¾“å…¥6ä½éªŒè¯ç ');
        return;
      }

      // æ¨¡æ‹ŸéªŒè¯ï¼ˆå»æ‰alertï¼Œæ”¹ç”¨æ·¡å‡ºæç¤ºï¼‰
      // æ›´æ–°æ˜¾ç¤º
      document.getElementById('phone-display').textContent = phone.substring(0, 3) + '****' + phone.substring(7);
      hidePhoneBinding();

      // æ¸…ç©ºè¾“å…¥
      document.getElementById('new-phone-input').value = '';
      document.getElementById('verify-code-input').value = '';

      // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
      showSaveSuccessTip();
    }

    // ä¿å­˜ä¸ªäººèµ„æ–™
    function saveProfile() {
      const nickname = document.getElementById('nickname-input').value;
      const birthday = document.getElementById('birthday-input').value;
      const gender = document.getElementById('gender-display').textContent;

      showToast('ä¸ªäººèµ„æ–™å·²ä¿å­˜');

      // æ›´æ–°ä¸ªäººä¸­å¿ƒé¡µé¢çš„æ˜¾ç¤º
      const profileCard = document.querySelector('[data-component="profile-header"] .font-medium');
      if (profileCard) {
        profileCard.textContent = nickname;
      }

      backToProfileFromEdit();
    }

    // Toastæç¤º
    function showToast(message, duration = 2000) {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      toastMessage.textContent = message;
      toast.classList.remove('hidden');

      setTimeout(() => {
        toast.classList.add('hidden');
      }, duration);
    }

    // ä¸ªäººä¿¡æ¯æ”¶é›†å’Œæƒé™æ¸…å•
    function showPrivacyInfo(type) {
      const title = type === 'collect' ? 'ä¸ªäººä¿¡æ¯æ”¶é›†æ¸…å•' : 'æƒé™æ¸…å•';
      showToast(`æŸ¥çœ‹${title}`);
    }

    // ç”¨æˆ·åè®®å’Œéšç§æ”¿ç­–
    function showAgreement(type) {
      const title = type === 'user' ? 'ç”¨æˆ·åè®®' : 'éšç§æ”¿ç­–';
      showToast(`è·³è½¬åˆ°${title}é¡µé¢`);
    }

    // é€€å‡ºç™»å½•
    function confirmLogout() {
      if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        showToast('å·²é€€å‡ºç™»å½•');
        setTimeout(() => {
          showToast('è·³è½¬åˆ°ç™»å½•é¡µé¢');
        }, 2000);
      }
    }

    // è´¦å·æ³¨é”€ç›¸å…³
    let deletionCodeVerified = false;
    let deletionCountdown = 0;

    function showAccountDeletion() {
      document.getElementById('page-profile-edit').classList.add('hidden');
      document.getElementById('page-account-deletion').classList.remove('hidden');
      updateNavbar('è´¦å·æ³¨é”€', true, 'backToProfileEdit()');
    }

    function backToProfileEdit() {
      document.getElementById('page-account-deletion').classList.add('hidden');
      document.getElementById('page-profile-edit').classList.remove('hidden');
      updateNavbar('ä¸ªäººèµ„æ–™', true, 'backToProfileFromEdit()');

      // é‡ç½®æ³¨é”€é¡µé¢çŠ¶æ€
      deletionCodeVerified = false;
      document.getElementById('deletion-verify-code').value = '';
      document.getElementById('deletion-agree-checkbox').checked = false;
      checkDeletionEnable();
    }

    function sendDeletionCode() {
      // æ¨¡æ‹Ÿå‘é€éªŒè¯ç 
      showToast('éªŒè¯ç å·²å‘é€åˆ° 138****5678');

      // å€’è®¡æ—¶60ç§’
      deletionCountdown = 60;
      const btn = document.getElementById('deletion-send-btn');
      btn.disabled = true;
      btn.classList.add('opacity-50');

      const timer = setInterval(() => {
        deletionCountdown--;
        btn.textContent = `${deletionCountdown}ç§’åé‡å‘`;

        if (deletionCountdown <= 0) {
          clearInterval(timer);
          btn.disabled = false;
          btn.classList.remove('opacity-50');
          btn.textContent = 'å‘é€éªŒè¯ç ';
        }
      }, 1000);
    }

    function checkDeletionEnable() {
      const code = document.getElementById('deletion-verify-code').value;
      const agreed = document.getElementById('deletion-agree-checkbox').checked;
      const btn = document.getElementById('confirm-deletion-btn');

      // éªŒè¯ç é•¿åº¦ä¸º6ä½ä¸”å·²å‹¾é€‰åè®®
      if (code.length === 6 && agreed) {
        deletionCodeVerified = true;
        btn.disabled = false;
        btn.classList.remove('bg-gray-300', 'text-gray-500');
        btn.classList.add('bg-red-500', 'text-white');
      } else {
        deletionCodeVerified = false;
        btn.disabled = true;
        btn.classList.remove('bg-red-500', 'text-white');
        btn.classList.add('bg-gray-300', 'text-gray-500');
      }
    }

    // ç›‘å¬éªŒè¯ç è¾“å…¥
    document.addEventListener('DOMContentLoaded', () => {
      const deletionCodeInput = document.getElementById('deletion-verify-code');
      if (deletionCodeInput) {
        deletionCodeInput.addEventListener('input', checkDeletionEnable);
      }
    });

    function showDeletionTerms() {
      showToast('æŸ¥çœ‹ã€Šæ³¨é”€æœåŠ¡é¡»çŸ¥ã€‹');
    }

    function confirmAccountDeletion() {
      if (!deletionCodeVerified) {
        showToast('è¯·å…ˆå®ŒæˆéªŒè¯');
        return;
      }

      if (confirm('æœ€åç¡®è®¤ï¼šç¡®å®šè¦æ³¨é”€è´¦å·å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
        // æ¨¡æ‹Ÿæ³¨é”€è¿‡ç¨‹
        showToast('æ­£åœ¨æ³¨é”€è´¦å·...', 3000);

        setTimeout(() => {
          showToast('è´¦å·æ³¨é”€æˆåŠŸ', 2000);
          setTimeout(() => {
            showToast('è´¦å·å·²æ³¨é”€ï¼Œå³å°†é€€å‡ºç™»å½•');
            // è¿™é‡Œåº”è¯¥è·³è½¬åˆ°ç™»å½•é¡µé¢
          }, 2000);
        }, 3000);
      }
    }

    // ç­›é€‰å™¨å±‚çº§å…³ç³»æ•°æ®ï¼ˆå¹³å° â†’ ä¸“è¾‘ â†’ æ­Œæ›²ï¼‰
    const filterHierarchy = {
      platforms: {
        'netease': {
          name: 'ç½‘æ˜“',
          albums: ['albumA', 'albumB', 'albumC'],
          songs: ['song1', 'song2', 'song3', 'song4']
        },
        'tme': {
          name: 'TME',
          albums: ['albumD', 'albumE'],
          songs: ['song5', 'song6', 'song7']
        },
        'kugou': {
          name: 'é…·ç‹—',
          albums: ['albumF', 'albumG'],
          songs: ['song1', 'song5']  // å¯èƒ½æœ‰é‡å¤æ­Œæ›²
        },
        'aiting': {
          name: 'çˆ±å¬',
          albums: ['albumA', 'albumF'],  // å¯èƒ½æœ‰é‡å¤ä¸“è¾‘
          songs: ['song2', 'song6']
        }
      },
      albums: {
        'albumA': { name: 'ä¸“è¾‘A', songs: ['song1', 'song2'] },
        'albumB': { name: 'ä¸“è¾‘B', songs: ['song3'] },
        'albumC': { name: 'ä¸“è¾‘C', songs: ['song4'] },
        'albumD': { name: 'ä¸“è¾‘D', songs: ['song5'] },
        'albumE': { name: 'ä¸“è¾‘E', songs: ['song6', 'song7'] },
        'albumF': { name: 'ä¸“è¾‘F', songs: ['song1', 'song6'] },
        'albumG': { name: 'ä¸“è¾‘G', songs: ['song5'] }
      }
    };

    // ç­›é€‰å™¨çŠ¶æ€ç®¡ç†ï¼ˆçº§è”ç­›é€‰ï¼‰
    const filterState = {
      revenue: { currency: 'cny', platform: 'all', album: 'all', song: 'all' },
      'platform-dist': { currency: 'cny' },
      content: { album: 'all', song: 'all' }
    };

    // ä¸´æ—¶ç­›é€‰çŠ¶æ€ï¼ˆç¡®å®šå‰ä¸ç”Ÿæ•ˆï¼‰
    const tempFilterState = {
      revenue: { currency: 'cny', platform: 'all', album: 'all', song: 'all' },
      'platform-dist': { currency: 'cny' },
      content: { album: 'all', song: 'all' }
    };

    // ç­›é€‰å™¨ç›¸å…³å‡½æ•°

    // å¹³å°åç§°æ˜ å°„ï¼ˆä¸­æ–‡ â†’ data-valueï¼‰
    function getPlatformValue(chineseName) {
      const mapping = {
        'ç½‘æ˜“': 'netease',
        'TME': 'tme',
        'é…·ç‹—': 'kugou',
        'çˆ±å¬': 'aiting'
      };
      return mapping[chineseName] || 'all';
    }

    // æ˜¾ç¤ºç­›é€‰é¢æ¿
    function showFilterPanel(currency) {
      const panel = document.getElementById(`filter-panel-${currency}`);
      const drilldown = chartDrilldownState[currency];

      // å¤åˆ¶å½“å‰ç­›é€‰çŠ¶æ€åˆ°ä¸´æ—¶çŠ¶æ€
      tempFilterState[currency] = { ...filterState[currency] };

      // å¦‚æœæœ‰å›¾è¡¨ä¸‹é’»ï¼ŒåŒæ­¥ä¸‹é’»çŠ¶æ€åˆ°ç­›é€‰å™¨
      if (drilldown && drilldown.level === 'platform' && drilldown.selectedMonth) {
        // ä¸‹é’»åˆ°å¹³å°å±‚çº§ï¼Œé”å®šå¹³å°ç»´åº¦ï¼ˆä½†æ­¤æ—¶selectedMonthå­˜å‚¨çš„æ˜¯æœˆä»½ï¼Œéœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼è·å–å¹³å°ï¼‰
        // æš‚ä¸é”å®šï¼Œå› ä¸ºå¹³å°æ˜¯é€šè¿‡ç‚¹å‡»æœˆä»½åæ˜¾ç¤ºçš„åˆ†å¸ƒå›¾
      } else if (drilldown && drilldown.level === 'song' && drilldown.selectedPlatform) {
        // ä¸‹é’»åˆ°æ­Œæ›²å±‚çº§ï¼Œé”å®šå¹³å°ç»´åº¦
        const platformValue = getPlatformValue(drilldown.selectedPlatform);
        tempFilterState[currency].platform = platformValue;
      }

      // æ›´æ–°é¢æ¿æ˜¾ç¤ºçŠ¶æ€
      updateFilterPanelState(currency);
      // æ£€æŸ¥å¹¶åˆå§‹åŒ–å±•å¼€/æ”¶èµ·çŠ¶æ€ï¼ˆæ ¹æ®é¢æ¿ç±»å‹ï¼‰
      if (currency === 'revenue') {
        // revenue é¢æ¿æœ‰ platform, album, song é€‰é¡¹
        checkAndInitExpand(currency, 'platform');
        checkAndInitExpand(currency, 'album');
        checkAndInitExpand(currency, 'song');
      } else if (currency === 'content') {
        // content é¢æ¿åªæœ‰ album, song é€‰é¡¹
        checkAndInitExpand(currency, 'album');
        checkAndInitExpand(currency, 'song');
      }
      // platform-dist é¢æ¿åªæœ‰å¸ç§é€‰æ‹©ï¼Œä¸éœ€è¦è°ƒç”¨ checkAndInitExpand
      // æ˜¾ç¤ºé¢æ¿
      panel.classList.remove('hidden');
    }

    // éšè—ç­›é€‰é¢æ¿
    function hideFilterPanel(currency) {
      const panel = document.getElementById(`filter-panel-${currency}`);
      panel.classList.add('hidden');
    }

    // æ£€æŸ¥å¹¶åˆå§‹åŒ–å±•å¼€/æ”¶èµ·çŠ¶æ€
    function checkAndInitExpand(currency, type) {
      const container = document.getElementById(`${type}-options-${currency}`);
      const tagsContainer = container.querySelector('.flex.flex-wrap');
      const tags = tagsContainer.querySelectorAll('.filter-tag');

      // è®¡ç®—æ ‡ç­¾æ˜¯å¦è¶…è¿‡ä¸€è¡Œ
      if (tags.length > 5) {  // å‡è®¾è¶…è¿‡5ä¸ªæ ‡ç­¾å°±ä¼šè¶…è¿‡ä¸€è¡Œ
        // æ·»åŠ å±•å¼€/æ”¶èµ·æŒ‰é’®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
        let toggleBtn = container.querySelector('.toggle-expand-btn');
        if (!toggleBtn) {
          toggleBtn = document.createElement('button');
          toggleBtn.className = 'toggle-expand-btn text-sm text-red-500 mt-2';
          toggleBtn.textContent = 'å±•å¼€';
          toggleBtn.onclick = () => toggleExpand(currency, type);
          container.appendChild(toggleBtn);
        }

        // é»˜è®¤æ”¶èµ·
        if (container.dataset.expanded !== 'false') {
          container.dataset.expanded = 'false';
          tagsContainer.style.maxHeight = '32px';
          tagsContainer.style.overflow = 'hidden';
          toggleBtn.textContent = 'å±•å¼€';
        }
      }
    }

    // åˆ‡æ¢å±•å¼€/æ”¶èµ·
    function toggleExpand(currency, type) {
      const container = document.getElementById(`${type}-options-${currency}`);
      const tagsContainer = container.querySelector('.flex.flex-wrap');
      const toggleBtn = container.querySelector('.toggle-expand-btn');

      if (container.dataset.expanded === 'true') {
        container.dataset.expanded = 'false';
        tagsContainer.style.maxHeight = '32px';
        tagsContainer.style.overflow = 'hidden';
        toggleBtn.textContent = 'å±•å¼€';
      } else {
        container.dataset.expanded = 'true';
        tagsContainer.style.maxHeight = 'none';
        tagsContainer.style.overflow = 'visible';
        toggleBtn.textContent = 'æ”¶èµ·';
      }
    }

    // é€‰æ‹©ç­›é€‰é¡¹
    function selectFilter(currency, type, value, button) {
      // å¦‚æœæ ‡ç­¾è¢«ç¦ç”¨ï¼Œåˆ™ä¸å…è®¸ç‚¹å‡»
      if (button.disabled) {
        return;
      }

      // æ›´æ–°ä¸´æ—¶çŠ¶æ€
      tempFilterState[currency][type] = value;

      // çº§è”é€»è¾‘ï¼šé€‰æ‹©ä¸Šçº§æ—¶é‡ç½®ä¸‹çº§
      if (type === 'currency') {
        // åˆ‡æ¢å¸ç§ä¸é‡ç½®å…¶ä»–ç­›é€‰
      } else if (type === 'platform') {
        tempFilterState[currency].album = 'all';
        tempFilterState[currency].song = 'all';
      } else if (type === 'album') {
        tempFilterState[currency].song = 'all';
      }

      // æ›´æ–°æŒ‰é’®æ ·å¼
      const container = document.getElementById(`${type}-options-${currency}`);
      container.querySelectorAll('.filter-tag').forEach(tag => {
        tag.classList.remove('active');
      });
      button.classList.add('active');

      // æ›´æ–°çº§è”é€‰é¡¹çš„å¯é€‰çŠ¶æ€ï¼ˆå¸ç§ä¸éœ€è¦çº§è”ï¼‰
      if (type !== 'currency') {
        updateCascadeOptions(currency, type);
      }
    }

    // æ›´æ–°çº§è”é€‰é¡¹ï¼ˆç¦ç”¨/å¯ç”¨ä¸‹çº§é€‰é¡¹ï¼‰
    function updateCascadeOptions(currency, changedType) {
      const state = tempFilterState[currency];

      if (changedType === 'platform') {
        const albumContainer = document.getElementById(`album-options-${currency}`);
        const songContainer = document.getElementById(`song-options-${currency}`);

        if (state.platform === 'all') {
          // å¯ç”¨æ‰€æœ‰ä¸“è¾‘å’Œæ­Œæ›²
          enableAllTags(albumContainer);
          enableAllTags(songContainer);
        } else {
          // åªå¯ç”¨å½“å‰å¹³å°ä¸‹çš„ä¸“è¾‘å’Œæ­Œæ›²
          const platformData = filterHierarchy.platforms[state.platform];
          if (platformData) {
            enableOnlyTags(albumContainer, platformData.albums);
            enableOnlyTags(songContainer, platformData.songs);
          }
        }

        // é‡ç½®ä¸‹çº§é€‰ä¸­çŠ¶æ€
        resetTagSelection(albumContainer, 'all');
        resetTagSelection(songContainer, 'all');

      } else if (changedType === 'album') {
        const songContainer = document.getElementById(`song-options-${currency}`);

        if (state.album === 'all') {
          // å¦‚æœä¸“è¾‘æ˜¯"å…¨éƒ¨"ï¼Œæ ¹æ®å¹³å°ç­›é€‰æ­Œæ›²
          if (state.platform === 'all') {
            enableAllTags(songContainer);
          } else {
            const platformData = filterHierarchy.platforms[state.platform];
            if (platformData) {
              enableOnlyTags(songContainer, platformData.songs);
            }
          }
        } else {
          // åªå¯ç”¨å½“å‰ä¸“è¾‘ä¸‹çš„æ­Œæ›²
          const albumData = filterHierarchy.albums[state.album];
          if (albumData) {
            enableOnlyTags(songContainer, albumData.songs);
          }
        }

        // é‡ç½®æ­Œæ›²é€‰ä¸­çŠ¶æ€
        resetTagSelection(songContainer, 'all');
      }
    }

    // å¯ç”¨æ‰€æœ‰æ ‡ç­¾
    function enableAllTags(container) {
      container.querySelectorAll('.filter-tag').forEach(tag => {
        tag.disabled = false;
        tag.classList.remove('opacity-50', 'cursor-not-allowed');
      });
    }

    // åªå¯ç”¨æŒ‡å®šçš„æ ‡ç­¾
    function enableOnlyTags(container, enabledValues) {
      container.querySelectorAll('.filter-tag').forEach(tag => {
        const value = tag.dataset.value;
        if (value === 'all' || enabledValues.includes(value)) {
          tag.disabled = false;
          tag.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
          tag.disabled = true;
          tag.classList.add('opacity-50', 'cursor-not-allowed');
        }
      });
    }

    // é‡ç½®æ ‡ç­¾é€‰ä¸­çŠ¶æ€
    function resetTagSelection(container, defaultValue) {
      container.querySelectorAll('.filter-tag').forEach(tag => {
        tag.classList.remove('active');
        if (tag.dataset.value === defaultValue) {
          tag.classList.add('active');
        }
      });
    }

    // æ›´æ–°ç­›é€‰é¢æ¿çŠ¶æ€
    function updateFilterPanelState(currency) {
      const drilldown = chartDrilldownState[currency];

      // æ›´æ–°å¸ç§é€‰æ‹©å™¨çŠ¶æ€
      const currencyContainer = document.getElementById(`currency-options-${currency}`);
      if (currencyContainer) {
        const currentCurrency = tempFilterState[currency].currency;
        currencyContainer.querySelectorAll('.filter-tag').forEach(tag => {
          tag.classList.remove('active');
          if (tag.dataset.value === currentCurrency) {
            tag.classList.add('active');
          }
        });
      }

      ['platform', 'album', 'song'].forEach(type => {
        const container = document.getElementById(`${type}-options-${currency}`);
        if (!container) return;
        const currentValue = tempFilterState[currency][type];

        // æ£€æŸ¥æ˜¯å¦éœ€è¦é”å®šè¯¥ç»´åº¦
        let shouldLock = false;

        if (drilldown && type === 'platform' && drilldown.level === 'song' && drilldown.selectedPlatform) {
          // ä¸‹é’»åˆ°æ­Œæ›²å±‚çº§æ—¶ï¼Œé”å®šå¹³å°é€‰æ‹©
          shouldLock = true;
        }

        container.querySelectorAll('.filter-tag').forEach(tag => {
          // ç§»é™¤æ‰€æœ‰çŠ¶æ€
          tag.classList.remove('active', 'opacity-50', 'cursor-not-allowed');
          tag.disabled = false;

          if (shouldLock) {
            // é”å®šçŠ¶æ€ï¼šç¦ç”¨æ‰€æœ‰æ ‡ç­¾
            tag.disabled = true;
            tag.classList.add('opacity-50', 'cursor-not-allowed');

            // é€‰ä¸­å½“å‰å€¼
            if (tag.dataset.value === currentValue) {
              tag.classList.add('active');
              tag.classList.remove('opacity-50'); // é€‰ä¸­çš„æ ‡ç­¾ä¸é€æ˜
            }
          } else {
            // æ­£å¸¸çŠ¶æ€ï¼šåªé«˜äº®é€‰ä¸­é¡¹
            if (tag.dataset.value === currentValue) {
              tag.classList.add('active');
            }
          }
        });
      });
    }

    // åº”ç”¨ç­›é€‰
    function applyFilters(currency) {
      // å°†ä¸´æ—¶çŠ¶æ€åº”ç”¨åˆ°æ­£å¼çŠ¶æ€
      filterState[currency] = { ...tempFilterState[currency] };

      // å¦‚æœæ˜¯revenueï¼Œæ›´æ–°æ ‡é¢˜æ˜¾ç¤ºå¸ç§
      if (currency === 'revenue') {
        const selectedCurrency = filterState[currency].currency;
        const currencyLabel = selectedCurrency.toUpperCase();
        document.getElementById('revenue-title').textContent = `ç»è¥æƒ…å†µ - ${currencyLabel}`;

        // é‡ç½®ä¸‹é’»çŠ¶æ€å¹¶åˆ·æ–°å›¾è¡¨
        resetChartDrilldown('revenue');
      }

      // å¦‚æœæ˜¯platform-distï¼Œæ›´æ–°æ ‡é¢˜æ˜¾ç¤ºå¸ç§
      if (currency === 'platform-dist') {
        const selectedCurrency = filterState[currency].currency;
        const currencyLabel = selectedCurrency.toUpperCase();
        document.getElementById('platform-dist-title').textContent = `å¹³å°åˆ†å¸ƒ - ${currencyLabel}`;
      }

      // æ›´æ–°ç­›é€‰æŒ‰é’®çŠ¶æ€
      updateFilterButtonState(currency);

      // åˆ·æ–°å›¾è¡¨
      refreshChart(currency);

      // éšè—é¢æ¿
      hideFilterPanel(currency);
    }

    // æ›´æ–°ç­›é€‰æŒ‰é’®çŠ¶æ€
    function updateFilterButtonState(currency) {
      const btn = document.getElementById(`filter-btn-${currency}`);
      if (!btn) return;  // å¦‚æœæŒ‰é’®ä¸å­˜åœ¨åˆ™ç›´æ¥è¿”å›

      const state = filterState[currency];
      if (!state) return;

      // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•ç­›é€‰ï¼ˆæ’é™¤'all'ï¼‰
      const hasFilter = (state.platform && state.platform !== 'all') ||
                       (state.album && state.album !== 'all') ||
                       (state.song && state.song !== 'all');

      if (hasFilter) {
        btn.textContent = 'å·²ç­›é€‰';
        btn.classList.add('text-red-500', 'border-red-500');
        btn.classList.remove('text-gray-600', 'border-gray-300');
      } else {
        btn.textContent = 'ç­›é€‰';
        btn.classList.remove('text-red-500', 'border-red-500');
        btn.classList.add('text-gray-600', 'border-gray-300');
      }
    }

    // é‡ç½®ç­›é€‰
    function resetFilters(currency) {
      // æ ¹æ®ä¸åŒé¢æ¿ç±»å‹é‡ç½®ä¸´æ—¶çŠ¶æ€
      if (currency === 'content') {
        tempFilterState[currency] = { album: 'all', song: 'all' };
      } else if (currency === 'platform-dist') {
        const currentCurrency = tempFilterState[currency].currency || 'cny';
        tempFilterState[currency] = { currency: currentCurrency };
      } else {
        // revenue å’Œå…¶ä»–å¸¦ currency çš„é¢æ¿
        const currentCurrency = tempFilterState[currency].currency || 'cny';
        tempFilterState[currency] = { currency: currentCurrency, platform: 'all', album: 'all', song: 'all' };
      }

      // æ›´æ–°é¢æ¿æ˜¾ç¤º
      updateFilterPanelState(currency);
    }

    // å›¾è¡¨ä¸‹é’»å‡½æ•°

    // ä¸‹é’»åˆ°å¹³å°è§†å›¾
    function drillDownToPlatform(currency, params) {
      const drilldown = chartDrilldownState[currency];
      const metric = params.seriesName === 'æ”¶å…¥' ? 'revenue' :
                     params.seriesName === 'æ’­æ”¾é‡' ? 'plays' :
                     params.seriesName === 'é”€å”®é‡' ? 'sales' : 'downloads';

      drilldown.level = 'platform';
      drilldown.metric = metric;
      drilldown.selectedMonth = params.name;
      drilldown.selectedPlatform = null;

      refreshChartDrilldown(currency);
      hideChartTooltip(currency);
    }

    // ä¸‹é’»åˆ°æ­Œæ›²è§†å›¾
    function drillDownToSong(currency, params) {
      const drilldown = chartDrilldownState[currency];

      drilldown.level = 'song';
      drilldown.selectedPlatform = params.name;

      refreshChartDrilldown(currency);
      hideChartTooltip(currency);
    }

    // å›¾è¡¨ Tooltip æ˜¾ç¤º/éšè—å‡½æ•°

    // æ˜¾ç¤ºå›¾è¡¨ Tooltip
    function showChartTooltip(currency, params, chartInstance) {
      const tooltip = document.getElementById(`chart-tooltip-${currency}`);
      const content = document.getElementById(`tooltip-content-${currency}`);
      const drilldown = chartDrilldownState[currency];

      if (!tooltip || !content || !drilldown) return;

      // æ„å»ºå†…å®¹
      let drilldownHint = '';
      if (drilldown.level === 'time') {
        drilldownHint = `<div class="tooltip-drilldown-link" data-currency="${currency}" data-level="platform">ç‚¹å‡»æŸ¥çœ‹å¹³å°åˆ†å¸ƒ</div>`;
      } else if (drilldown.level === 'platform') {
        drilldownHint = `<div class="tooltip-drilldown-link" data-currency="${currency}" data-level="song">ç‚¹å‡»æŸ¥çœ‹æ­Œæ›²åˆ†å¸ƒ</div>`;
      }

      content.innerHTML = `
        <div class="font-medium text-gray-800">${params.name}</div>
        <div class="text-sm text-gray-600 mt-1">${params.seriesName}: ${params.value.toLocaleString()}</div>
        ${drilldownHint}
      `;

      // å®šä½åˆ°ç‚¹å‡»ä½ç½®
      const clickX = params.event.offsetX;
      const clickY = params.event.offsetY;

      tooltip.style.left = `${clickX + 10}px`;
      tooltip.style.top = `${clickY + 10}px`;

      // æ˜¾ç¤º tooltip
      tooltip.classList.remove('hidden');

      // å­˜å‚¨å½“å‰ç‚¹å‡»çš„ paramsï¼Œä¾›ä¸‹é’»ä½¿ç”¨
      tooltip.dataset.clickParams = JSON.stringify({
        name: params.name,
        seriesName: params.seriesName,
        value: params.value
      });
    }

    // éšè—å›¾è¡¨ Tooltip
    function hideChartTooltip(currency) {
      const tooltip = document.getElementById(`chart-tooltip-${currency}`);
      if (tooltip) {
        tooltip.classList.add('hidden');
      }
    }

    // å›¾è¡¨æ•°æ®ç‚¹ä¸‹é’»çŠ¶æ€ç®¡ç†
    const chartDrilldownState = {
      revenue: {
        level: 'time',           // 'time' | 'platform' | 'song'
        metric: null,            // 'plays' | 'downloads' | 'sales' | 'revenue'
        selectedMonth: null,     // '3æœˆ'
        selectedPlatform: null,  // 'TME'
        timeRange: 3             // å½“å‰æ—¶é—´èŒƒå›´ï¼ˆæœˆæ•°ï¼‰
      }
    };

    // æ—¶é—´èŒƒå›´æ›´æ–°
    function updateTimeRange(currency, months, button) {
      // æ›´æ–°æŒ‰é’®æ ·å¼
      const container = document.getElementById(`${currency}-time-filter`);
      container.querySelectorAll('.chip').forEach(btn => {
        btn.classList.remove('active');
      });
      button.classList.add('active');

      // é‡ç½®å›¾è¡¨ä¸‹é’»çŠ¶æ€å¹¶æ›´æ–°æ—¶é—´èŒƒå›´
      chartDrilldownState[currency].timeRange = months;
      resetChartDrilldown(currency);
    }

    // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
    function generateMonthData(months) {
      const monthNames = [];
      const revenue = [];
      const plays = [];
      const sales = [];
      const downloads = [];

      for (let i = months; i > 0; i--) {
        const date = new Date();
        date.setMonth(date.getMonth() - i + 1);
        const year = date.getFullYear() % 100;  // è·å–å¹´ä»½åä¸¤ä½
        monthNames.push(`${year}å¹´${date.getMonth() + 1}æœˆ`);
        revenue.push(Math.floor(10000 + Math.random() * 10000));
        plays.push(Math.floor(100000 + Math.random() * 100000));
        sales.push(Math.floor(2000 + Math.random() * 4000));
        downloads.push(Math.floor(1500 + Math.random() * 2500));
      }

      return { months: monthNames, revenue, plays, sales, downloads };
    }

    // ç”Ÿæˆå¹³å°ç»´åº¦æ•°æ®ï¼ˆæŸæœˆçš„å„å¹³å°åˆ†å¸ƒï¼‰
    function generatePlatformData(month, metric, currency) {
      const platforms = ['ç½‘æ˜“', 'TME', 'é…·ç‹—', 'çˆ±å¬'];
      const platformData = [];

      // æ ¹æ®æŒ‡æ ‡ç±»å‹ç”Ÿæˆä¸åŒèŒƒå›´çš„æ•°æ®
      const ranges = {
        revenue: currency === 'cny' ? [2000, 5000] : [200, 500],
        plays: currency === 'cny' ? [20000, 50000] : [1500, 3000],
        sales: currency === 'cny' ? [500, 1500] : [80, 180],
        downloads: currency === 'cny' ? [300, 1000] : [50, 120]
      };

      const [min, max] = ranges[metric];
      for (let i = 0; i < platforms.length; i++) {
        platformData.push(Math.floor(min + Math.random() * (max - min)));
      }

      return { platforms, data: platformData };
    }

    // ç”Ÿæˆæ­Œæ›²ç»´åº¦æ•°æ®ï¼ˆæŸå¹³å°çš„å„æ­Œæ›²åˆ†å¸ƒï¼‰
    function generateSongData(month, platform, metric, currency) {
      const songs = ['æ˜¥å¤©çš„æ•…äº‹', 'å¤æ—¥å›å¿†', 'ç§‹å¤©çš„ç«¥è¯', 'å†¬æ—¥æš–é˜³', 'æ˜Ÿç©ºä¸‹çš„çº¦å®š'];
      const songData = [];

      // æ ¹æ®æŒ‡æ ‡ç±»å‹ç”Ÿæˆä¸åŒèŒƒå›´çš„æ•°æ®
      const ranges = {
        revenue: currency === 'cny' ? [400, 1200] : [40, 120],
        plays: currency === 'cny' ? [4000, 12000] : [300, 800],
        sales: currency === 'cny' ? [100, 400] : [15, 45],
        downloads: currency === 'cny' ? [60, 250] : [10, 30]
      };

      const [min, max] = ranges[metric];
      for (let i = 0; i < songs.length; i++) {
        songData.push(Math.floor(min + Math.random() * (max - min)));
      }

      return { songs, data: songData };
    }

    // å›¾è¡¨ç‚¹å‡»äº‹ä»¶å¤„ç†
    function handleChartClick(currency, params) {
      const state = chartDrilldownState[currency];

      // è·å–æŒ‡æ ‡åç§°æ˜ å°„
      const metricMap = {
        'æ’­æ”¾é‡': 'plays',
        'ä¸‹è½½é‡': 'downloads',
        'é”€å”®é‡': 'sales',
        'æ”¶å…¥': 'revenue'
      };

      const metric = metricMap[params.seriesName];
      if (!metric) return;  // åªå¤„ç†å››ä¸ªä¸»è¦æŒ‡æ ‡

      // æ ¹æ®å½“å‰å±‚çº§å¤„ç†ç‚¹å‡»
      if (state.level === 'time') {
        // ç¬¬ä¸€å±‚ï¼šæ—¶é—´ç»´åº¦ -> ä¸‹é’»åˆ°å¹³å°ç»´åº¦
        state.level = 'platform';
        state.metric = metric;
        state.selectedMonth = params.name;  // ä¾‹å¦‚ '3æœˆ'
        refreshChartDrilldown(currency);
      } else if (state.level === 'platform') {
        // ç¬¬äºŒå±‚ï¼šå¹³å°ç»´åº¦ -> ä¸‹é’»åˆ°æ­Œæ›²ç»´åº¦
        state.level = 'song';
        state.selectedPlatform = params.name;  // ä¾‹å¦‚ 'TME'
        refreshChartDrilldown(currency);
      }
      // ç¬¬ä¸‰å±‚ï¼šæ­Œæ›²ç»´åº¦ï¼Œç‚¹å‡»ä¸å†ä¸‹é’»
    }

    // åˆ·æ–°å›¾è¡¨ï¼ˆæ ¹æ®ä¸‹é’»å±‚çº§ï¼‰
    function refreshChartDrilldown(currency) {
      const state = chartDrilldownState[currency];
      const chart = charts[currency];
      if (!chart) return;

      const metricNames = {
        plays: 'æ’­æ”¾é‡',
        downloads: 'ä¸‹è½½é‡',
        sales: 'é”€å”®é‡',
        revenue: 'æ”¶å…¥'
      };

      // ä» filterState è·å–é€‰ä¸­çš„å¸ç§
      const selectedCurrency = currency === 'revenue' ? filterState.revenue.currency : currency;
      const currencySymbol = selectedCurrency === 'cny' ? 'Â¥' : 'â‚¬';
      let option;

      if (state.level === 'time') {
        // ç¬¬ä¸€å±‚ï¼šæ—¶é—´ç»´åº¦ï¼ˆé»˜è®¤è§†å›¾ï¼‰
        const monthData = generateMonthData(state.timeRange);
        option = {
          tooltip: { show: false },
          legend: { data: ['æ”¶å…¥', 'æ’­æ”¾é‡', 'é”€å”®é‡', 'ä¸‹è½½é‡'], bottom: 0 },
          grid: { left: '3%', right: '4%', bottom: '15%', containLabel: true },
          xAxis: {
            type: 'category',
            data: monthData.months,
            axisLabel: {
              interval: 0,  // æ˜¾ç¤ºæ‰€æœ‰åˆ»åº¦
              rotate: monthData.months.length > 6 ? 30 : 0  // è¶…è¿‡6ä¸ªæœˆæ—¶å€¾æ–œ30åº¦
            }
          },
          yAxis: [
            { type: 'value', name: `æ”¶å…¥(${currencySymbol})`, position: 'left' },
            { type: 'value', name: 'æ•°é‡', position: 'right' }
          ],
          series: [
            {
              name: 'æ”¶å…¥',
              type: 'line',
              data: monthData.revenue,
              yAxisIndex: 0,
              cursor: 'pointer',
              emphasis: { focus: 'series', blurScope: 'coordinateSystem' },
              lineStyle: { width: 3 },
              smooth: true
            },
            {
              name: 'æ’­æ”¾é‡',
              type: 'bar',
              data: monthData.plays,
              yAxisIndex: 1,
              cursor: 'pointer',
              emphasis: {
                focus: 'series',
                itemStyle: {
                  shadowBlur: 10,
                  shadowOffsetX: 0,
                  shadowOffsetY: 0,
                  shadowColor: 'rgba(249, 59, 61, 0.5)'
                }
              }
            },
            {
              name: 'é”€å”®é‡',
              type: 'bar',
              data: monthData.sales,
              yAxisIndex: 1,
              cursor: 'pointer',
              emphasis: {
                focus: 'series',
                itemStyle: {
                  shadowBlur: 10,
                  shadowOffsetX: 0,
                  shadowOffsetY: 0,
                  shadowColor: 'rgba(16, 185, 129, 0.5)'
                }
              }
            },
            {
              name: 'ä¸‹è½½é‡',
              type: 'bar',
              data: monthData.downloads,
              yAxisIndex: 1,
              cursor: 'pointer',
              emphasis: {
                focus: 'series',
                itemStyle: {
                  shadowBlur: 10,
                  shadowOffsetX: 0,
                  shadowOffsetY: 0,
                  shadowColor: 'rgba(139, 92, 246, 0.5)'
                }
              }
            }
          ],
          animation: true,
          animationDuration: 800,
          animationEasing: 'cubicOut'
        };
      } else if (state.level === 'platform') {
        // ç¬¬äºŒå±‚ï¼šå¹³å°ç»´åº¦
        const platformData = generatePlatformData(state.selectedMonth, state.metric, selectedCurrency);
        const metricName = metricNames[state.metric];
        const isRevenue = state.metric === 'revenue';

        option = {
          title: {
            text: `${state.selectedMonth}${metricName}çš„å¹³å°åˆ†å¸ƒ`,
            left: 'center',
            textStyle: { fontSize: 14, fontWeight: 'normal', color: '#6b7280' }
          },
          tooltip: { show: false },
          grid: { left: '3%', right: '4%', bottom: '10%', top: '15%', containLabel: true },
          xAxis: {
            type: 'category',
            data: platformData.platforms,
            axisLabel: {
              interval: 0,  // æ˜¾ç¤ºæ‰€æœ‰åˆ»åº¦
              rotate: 0
            }
          },
          yAxis: {
            type: 'value',
            name: metricName + (isRevenue ? `(${currencySymbol})` : '')
          },
          series: [{
            name: metricName,
            type: 'bar',
            data: platformData.data,
            itemStyle: {
              color: isRevenue ? '#F93B3D' : '#10b981'
            },
            cursor: 'pointer',
            emphasis: {
              itemStyle: {
                shadowBlur: 15,
                shadowOffsetX: 0,
                shadowOffsetY: 5,
                shadowColor: isRevenue ? 'rgba(249, 59, 61, 0.6)' : 'rgba(16, 185, 129, 0.6)'
              }
            },
            label: {
              show: true,
              position: 'top',
              formatter: function(params) {
                return params.value.toLocaleString();
              }
            }
          }],
          animation: true,
          animationDuration: 600,
          animationEasing: 'elasticOut'
        };
      } else if (state.level === 'song') {
        // ç¬¬ä¸‰å±‚ï¼šæ­Œæ›²ç»´åº¦
        const songData = generateSongData(state.selectedMonth, state.selectedPlatform, state.metric, selectedCurrency);
        const metricName = metricNames[state.metric];
        const isRevenue = state.metric === 'revenue';

        option = {
          title: {
            text: `${state.selectedPlatform}å¹³å°çš„æ­Œæ›²${metricName}åˆ†å¸ƒ`,
            left: 'center',
            textStyle: { fontSize: 14, fontWeight: 'normal', color: '#6b7280' }
          },
          tooltip: { show: false },
          grid: { left: '3%', right: '4%', bottom: '12%', top: '15%', containLabel: true },
          xAxis: {
            type: 'category',
            data: songData.songs,
            axisLabel: {
              interval: 0,  // æ˜¾ç¤ºæ‰€æœ‰åˆ»åº¦
              rotate: 30,  // æ­Œæ›²åç§°è¾ƒé•¿ï¼Œå€¾æ–œ30åº¦
              fontSize: 11
            }
          },
          yAxis: {
            type: 'value',
            name: metricName + (isRevenue ? `(${currencySymbol})` : '')
          },
          series: [{
            name: metricName,
            type: 'bar',
            data: songData.data,
            itemStyle: {
              color: isRevenue ? '#F93B3D' : '#8b5cf6'
            },
            emphasis: {
              itemStyle: {
                shadowBlur: 15,
                shadowOffsetX: 0,
                shadowOffsetY: 5,
                shadowColor: isRevenue ? 'rgba(249, 59, 61, 0.6)' : 'rgba(139, 92, 246, 0.6)'
              }
            },
            label: {
              show: true,
              position: 'top',
              formatter: function(params) {
                return params.value.toLocaleString();
              },
              fontSize: 11
            }
          }],
          animation: true,
          animationDuration: 600,
          animationEasing: 'elasticOut'
        };
      }

      chart.setOption(option, true);  // ä½¿ç”¨ notMerge=true å®Œå…¨æ›¿æ¢é…ç½®
      updateChartBreadcrumb(currency);  // æ›´æ–°é¢åŒ…å±‘
    }

    // é‡ç½®å›¾è¡¨ä¸‹é’»çŠ¶æ€
    function resetChartDrilldown(currency) {
      chartDrilldownState[currency] = {
        level: 'time',
        metric: null,
        selectedMonth: null,
        selectedPlatform: null,
        timeRange: chartDrilldownState[currency].timeRange
      };
      refreshChartDrilldown(currency);
      hideChartTooltip(currency);
    }

    // é‡ç½®ä¸‹é’»ï¼ˆä»…å¤„ç†å›¾è¡¨ç‚¹å‡»ä¸‹é’»ï¼Œä¸å½±å“ç­›é€‰å™¨ï¼‰
    function resetDrilldown(currency, level) {
      // åªé‡ç½®å›¾è¡¨ä¸‹é’»çŠ¶æ€ï¼Œä¸å½±å“ç­›é€‰å™¨
      resetChartDrilldown(currency);
    }

    // æ›´æ–°é¢åŒ…å±‘ï¼ˆä»…æ˜¾ç¤ºå›¾è¡¨ç‚¹å‡»ä¸‹é’»è·¯å¾„ï¼Œä¸æ˜¾ç¤ºç­›é€‰å™¨çŠ¶æ€ï¼‰
    function updateBreadcrumb(currency) {
      const breadcrumb = document.getElementById(`${currency}-breadcrumb`);
      const state = chartDrilldownState[currency];

      let html = `<span class="breadcrumb-item" onclick="resetDrilldown('${currency}', 'time')">å…¨éƒ¨æ•°æ®</span>`;

      if (state.level === 'platform' && state.selectedMonth) {
        html += `<span class="breadcrumb-separator">></span>`;
        html += `<span class="breadcrumb-item">${state.selectedMonth}</span>`;
      }

      if (state.level === 'song' && state.selectedPlatform) {
        html += `<span class="breadcrumb-separator">></span>`;
        html += `<span class="breadcrumb-item">${state.selectedPlatform}</span>`;
      }

      breadcrumb.innerHTML = html;
    }

    // æ›´æ–°å›¾è¡¨ä¸‹é’»é¢åŒ…å±‘
    function updateChartBreadcrumb(currency) {
      const breadcrumb = document.getElementById(`${currency}-breadcrumb`);
      const state = chartDrilldownState[currency];

      const metricNames = {
        plays: 'æ’­æ”¾é‡',
        downloads: 'ä¸‹è½½é‡',
        sales: 'é”€å”®é‡',
        revenue: 'æ”¶å…¥'
      };

      let html = `<span class="breadcrumb-item" onclick="resetChartDrilldown('${currency}')">å…¨éƒ¨æ•°æ®</span>`;

      if (state.level === 'platform' || state.level === 'song') {
        html += `<span class="breadcrumb-separator">></span>`;
        html += `<span class="breadcrumb-item" onclick="resetChartDrilldown('${currency}')">${state.selectedMonth}${metricNames[state.metric]}</span>`;
      }

      if (state.level === 'song') {
        html += `<span class="breadcrumb-separator">></span>`;
        html += `<span class="breadcrumb-item">${state.selectedPlatform}å¹³å°</span>`;
      }

      breadcrumb.innerHTML = html;
    }

    // åˆ·æ–°å›¾è¡¨æ•°æ®
    function refreshChart(currency) {
      const chart = charts[currency];
      if (!chart) return;

      const filter = filterState[currency];
      const drilldown = chartDrilldownState[currency];

      // æ ¹æ®å›¾è¡¨ä¸‹é’»å±‚çº§ï¼Œé‡æ–°ç”Ÿæˆå¯¹åº”çš„æ•°æ®
      if (drilldown.level === 'time') {
        // æ—¶é—´ç»´åº¦ï¼šæ˜¾ç¤ºæœˆåº¦è¶‹åŠ¿
        const data = generateMonthData(drilldown.timeRange);
        const option = chart.getOption();

        // æ ¹æ®ç­›é€‰å™¨è°ƒæ•´æ•°æ®å€æ•°ï¼ˆæ¨¡æ‹Ÿç­›é€‰æ•ˆæœï¼‰
        let multiplier = 1;
        if (filter.platform !== 'all') multiplier *= 0.7;
        if (filter.album !== 'all') multiplier *= 0.6;
        if (filter.song !== 'all') multiplier *= 0.5;

        option.xAxis[0].data = data.months;
        option.series[0].data = data.revenue.map(v => Math.floor(v * multiplier));
        option.series[1].data = data.plays.map(v => Math.floor(v * multiplier));
        option.series[2].data = data.sales.map(v => Math.floor(v * multiplier));
        option.series[3].data = data.downloads.map(v => Math.floor(v * multiplier));

        chart.setOption(option, true);
      } else if (drilldown.level === 'platform' || drilldown.level === 'song') {
        // å¹³å°/æ­Œæ›²ç»´åº¦ç”± refreshChartDrilldown å¤„ç†
        refreshChartDrilldown(currency);
      }
    }

    // æ»šåŠ¨åˆ°æŒ‡å®šåŒºåŸŸ
    function scrollToSection(id) {
      document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
    }

    // è¿”å›é¡¶éƒ¨
    function scrollToTop() {
      const mainContent = document.getElementById('mainContent');
      mainContent.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ç›‘å¬æ•°æ®ä¸­å¿ƒé¡µé¢æ»šåŠ¨,æ§åˆ¶è¿”å›é¡¶éƒ¨æŒ‰é’®æ˜¾ç¤º
    document.getElementById('mainContent').addEventListener('scroll', function() {
      const backToTopBtn = document.getElementById('backToTop');
      const dataPage = document.getElementById('page-data');

      // åªåœ¨æ•°æ®ä¸­å¿ƒé¡µé¢æ˜¾ç¤ºè¿”å›é¡¶éƒ¨æŒ‰é’® (é™ä½é˜ˆå€¼åˆ°150px)
      if (!dataPage.classList.contains('hidden') && this.scrollTop > 150) {
        backToTopBtn.classList.add('show');
      } else {
        backToTopBtn.classList.remove('show');
      }
    });

    // çª—å£è°ƒæ•´æ—¶é‡ç»˜å›¾è¡¨
    window.addEventListener('resize', () => {
      Object.values(charts).forEach(chart => chart.resize());
    });

    // åˆå§‹åŒ–
    updateBadges();
  </script>
</body>
</html>
